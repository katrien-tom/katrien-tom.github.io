<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="MySQL基础知识"><title>MySQL基础知识</title>
<link rel=canonical href=https://blog.binggao.xyz/p/mysql-basic/><link rel=stylesheet href=/scss/style.min.a8f47317a9f46c1e65bca0d951ec2c4c458c9cd52902ff8d8538bdaf52c6d8a8.css><meta property='og:title' content="MySQL基础知识"><meta property='og:description' content="MySQL基础知识"><meta property='og:url' content='https://blog.binggao.xyz/p/mysql-basic/'><meta property='og:site_name' content='半夜酒的博客'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='MySQL'><meta property='article:tag' content='SQL'><meta property='article:published_time' content='2024-06-18T17:00:00+08:00'><meta property='article:modified_time' content='2024-06-18T17:00:00+08:00'><meta property='og:image' content='https://blog.binggao.xyz/assets/mysql.jpg'><meta name=twitter:title content="MySQL基础知识"><meta name=twitter:description content="MySQL基础知识"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://blog.binggao.xyz/assets/mysql.jpg'></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><div id=article-toolbar style=position:sticky;top:5px;z-index:1000><a href=/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>返回</span></a></div><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#11-数据定义语言ddldata-definition-language>1.1 数据定义语言DDL（Data Definition Language）</a></li><li><a href=#12-数据操纵语言dmldata-manipulation-language>1.2 数据操纵语言DML（Data Manipulation Language）</a></li><li><a href=#13-数据查询语言dqldata-querylanguage>1.3 数据查询语言DQL（Data QueryLanguage）</a></li><li><a href=#14-数据控制语言dcldata-control-language>1.4 数据控制语言DCL（Data Control Language）</a></li><li><a href=#15-mysql体系结构>1.5 MySQL体系结构</a><ol><li><a href=#151-mysql服务端的4层结构>1.5.1 MySQL服务端的4层结构</a></li></ol></li></ol><ol><li><a href=#21-创建create>2.1 创建（Create）</a></li><li><a href=#22-修改alter>2.2 修改（Alter）</a><ol><li><a href=#221-库的修改>2.2.1 库的修改</a></li><li><a href=#222-表的修改>2.2.2 表的修改</a></li></ol></li><li><a href=#23-删除drop>2.3 删除（Drop）</a></li><li><a href=#24-复制create>2.4 复制（Create）</a></li><li><a href=#25-六大约束>2.5 六大约束</a><ol><li><a href=#251-约束的添加分类>2.5.1 约束的添加分类</a></li><li><a href=#252-修改表时添加约束>2.5.2 修改表时添加约束</a></li><li><a href=#253-修改表时删除约束>2.5.3 修改表时删除约束</a></li></ol></li></ol><ol><li><a href=#31-插入语句insert>3.1 插入语句Insert</a></li><li><a href=#32-修改语句update>3.2 修改语句Update</a></li><li><a href=#33-删除语句delete>3.3 删除语句Delete</a><ol><li><a href=#331-方式一>3.3.1 方式一</a></li><li><a href=#332-方式二>3.3.2 方式二</a></li></ol></li></ol><ol><li><a href=#41-基础查询>4.1 基础查询</a></li><li><a href=#42-条件查询>4.2 条件查询</a></li><li><a href=#43-排序查询>4.3 排序查询</a></li><li><a href=#44-常见函数>4.4 常见函数</a><ol><li><a href=#441-单行函数-字符函数>4.4.1 单行函数-字符函数</a></li><li><a href=#442-单行函数-数学函数>4.4.2 单行函数-数学函数</a></li><li><a href=#443-单行函数-日期函数>4.4.3 单行函数-日期函数</a></li><li><a href=#444-单行函数-流程控制函数>4.4.4 单行函数-流程控制函数</a></li><li><a href=#445-分组函数>4.4.5 分组函数</a><ol><li><a href=#4451-count函数>4.4.5.1 count函数</a></li></ol></li></ol></li><li><a href=#45-分组查询>4.5 分组查询</a></li><li><a href=#46-连接查询>4.6 连接查询</a></li><li><a href=#47-子查询>4.7 子查询</a><ol><li><a href=#471-含义>4.7.1 含义</a></li><li><a href=#472-分类>4.7.2 分类</a><ol><li><a href=#4721-按子查询出现的位置>4.7.2.1 按子查询出现的位置</a></li><li><a href=#4722-按结果集的行列数不同>4.7.2.2 按结果集的行列数不同</a></li></ol></li></ol></li><li><a href=#48-分页查询>4.8 分页查询</a></li><li><a href=#49-union联合查询>4.9 union联合查询</a></li><li><a href=#410-dql的执行顺序>4.10 DQL的执行顺序</a></li></ol><ol><li><a href=#51-管理用户>5.1 管理用户</a><ol><li><a href=#512-查询用户>5.1.2 查询用户</a></li><li><a href=#513-创建用户>5.1.3 创建用户</a></li><li><a href=#514-修改用户密码>5.1.4 修改用户密码</a></li><li><a href=#515-删除用户>5.1.5 删除用户</a></li><li><a href=#516-注意事项>5.1.6 注意事项</a></li></ol></li><li><a href=#52-权限控制>5.2 权限控制</a><ol><li><a href=#521-查询权限>5.2.1 查询权限</a></li><li><a href=#522-授予权限>5.2.2 授予权限</a></li><li><a href=#523-撤销权限>5.2.3 撤销权限</a></li><li><a href=#524-刷新权限>5.2.4 刷新权限</a></li><li><a href=#524-注意事项>5.2.4 注意事项</a></li></ol></li></ol><ol><li><a href=#61-事务的acidacid属性>6.1 事务的ACID（acid）属性</a></li><li><a href=#62-事务的创建>6.2 事务的创建</a><ol><li><a href=#621-隐式事务>6.2.1 隐式事务</a></li><li><a href=#622-显式事务>6.2.2 显式事务</a></li></ol></li><li><a href=#63-并发事务>6.3 并发事务</a></li></ol><ol><li><a href=#71-应用场景>7.1 应用场景</a></li><li><a href=#72-创建视图>7.2 创建视图</a></li><li><a href=#73-修改视图>7.3 修改视图</a></li><li><a href=#74-删除视图>7.4 删除视图</a></li></ol><ol><li><a href=#81-系统变量>8.1 系统变量</a></li><li><a href=#82-自定义变量>8.2 自定义变量</a></li></ol><ol><li><a href=#91-空参列表>9.1 空参列表</a></li><li><a href=#92-in模式参数的存储过程>9.2 in模式参数的存储过程</a></li><li><a href=#93-out模式参数的存储过程>9.3 out模式参数的存储过程</a></li><li><a href=#94-inout模式参数的存储过程>9.4 inout模式参数的存储过程</a></li><li><a href=#95-删除存储过程>9.5 删除存储过程</a></li><li><a href=#96-查看存储过程结构>9.6 查看存储过程结构</a></li></ol><ol><li><a href=#101-创建函数>10.1 创建函数</a></li><li><a href=#102-查看函数>10.2 查看函数</a></li><li><a href=#103-删除函数>10.3 删除函数</a></li></ol><ol><li><a href=#111-分支结构>11.1 分支结构</a></li><li><a href=#112-循环结构>11.2 循环结构</a></li></ol><ol><li><a href=#121-基本操作>12.1 基本操作</a></li><li><a href=#122-innodb存储引擎>12.2 InnoDB存储引擎</a><ol><li><a href=#1221-介绍>12.2.1 介绍</a></li><li><a href=#1222-特点>12.2.2 特点</a></li><li><a href=#1223-文件>12.2.3 文件</a></li><li><a href=#1224-逻辑存储结构>12.2.4 逻辑存储结构</a></li></ol></li></ol><ol><li><a href=#131-索引的概述>13.1 索引的概述</a><ol><li><a href=#1311-介绍>13.1.1 介绍</a></li><li><a href=#1312-优缺点>13.1.2 优缺点</a></li></ol></li><li><a href=#132-索引的结构>13.2 索引的结构</a><ol><li><a href=#1321-二叉树>13.2.1 二叉树</a></li><li><a href=#1322-btree>13.2.2 Btree</a></li><li><a href=#1323-btree>13.2.3 B+Tree</a></li><li><a href=#1324-面试题>13.2.4 面试题</a></li></ol></li><li><a href=#133-索引的分类>13.3 索引的分类</a></li><li><a href=#134-索引的语法>13.4 索引的语法</a><ol><li><a href=#1341-创建索引>13.4.1 创建索引</a></li><li><a href=#1342-查看索引>13.4.2 查看索引</a></li><li><a href=#1343-删除索引>13.4.3 删除索引</a></li></ol></li><li><a href=#135-sql性能分析>13.5 SQL性能分析</a><ol><li><a href=#1351-sql-执行频率>13.5.1 SQL 执行频率</a></li><li><a href=#1352-慢查询日志>13.5.2 慢查询日志</a></li><li><a href=#1353-profile详情>13.5.3 profile详情</a></li><li><a href=#1354-explain执行计划>13.5.4 explain执行计划</a></li></ol></li><li><a href=#136-索引的使用>13.6 索引的使用</a><ol><li><a href=#1361-联合索引-最左前缀法则>13.6.1 联合索引-最左前缀法则</a></li><li><a href=#1362-索引失效>13.6.2 索引失效</a><ol><li><a href=#13621-范围查询>13.6.2.1 范围查询</a></li><li><a href=#13622-索引列运算>13.6.2.2 索引列运算</a></li><li><a href=#13623-字符串不加引号>13.6.2.3 字符串不加引号</a></li><li><a href=#13624-模糊查询>13.6.2.4 模糊查询</a></li><li><a href=#13625-or连接的条件>13.6.2.5 OR连接的条件</a></li><li><a href=#13626-数据分布影响>13.6.2.6 数据分布影响</a></li></ol></li><li><a href=#1363-sql提示>13.6.3 SQL提示</a></li><li><a href=#1364-覆盖索引>13.6.4 覆盖索引</a></li><li><a href=#1365-前缀索引>13.6.5 前缀索引</a></li><li><a href=#1366-单列索引联合索引>13.6.6 单列索引&联合索引</a></li></ol></li><li><a href=#137-索引的设计原则>13.7 索引的设计原则</a></li></ol><ol><li><a href=#141-插入数据优化>14.1 插入数据优化</a><ol><li><a href=#1411-普通插入>14.1.1 普通插入</a></li><li><a href=#1412-大批量插入>14.1.2 大批量插入</a></li></ol></li><li><a href=#142-主键优化>14.2 主键优化</a><ol><li><a href=#1421-数据组织方式>14.2.1 数据组织方式</a></li><li><a href=#1422-主键设计原则>14.2.2 主键设计原则</a></li></ol></li><li><a href=#143-order-by-优化>14.3 Order By 优化</a></li><li><a href=#144-group-by-优化>14.4 Group By 优化</a></li><li><a href=#145-limit优化>14.5 Limit优化</a></li><li><a href=#146-count优化>14.6 Count优化</a></li><li><a href=#147-update优化避免行锁升级为表锁>14.7 Update优化（避免行锁升级为表锁）</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/mysql-basic/><img src=/assets/mysql.jpg loading=lazy alt="Featured image of post MySQL基础知识"></a></div><div class=article-details><header class=article-category><a href=/categories/mysql/>MySQL</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/mysql-basic/>MySQL基础知识</a></h2><h3 class=article-subtitle>MySQL基础知识</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jun 18, 2024</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 33 分钟</time></div></footer></div></header><section class=article-content><h1 id=mysql基础知识><a href=#mysql%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86>#</a>
MySQL基础知识</h1><h1 id=1-sql语言的分类><a href=#1-sql%e8%af%ad%e8%a8%80%e7%9a%84%e5%88%86%e7%b1%bb>#</a>
1. SQL语言的分类</h1><p>SQL语言共分为四大类：数据定义语言DDL，数据操纵语言DML，数据查询语言DQL，数据控制语言DCL。</p><h2 id=11-数据定义语言ddldata-definition-language><a href=#11-%e6%95%b0%e6%8d%ae%e5%ae%9a%e4%b9%89%e8%af%ad%e8%a8%80ddldata-definition-language>#</a>
1.1 数据定义语言DDL（Data Definition Language）</h2><p>​ 数据定义语言DDL用来创建数据库中的各种对象&mdash;&ndash;表、视图、索引、同义词、聚簇等如：CREATE TABLE/VIEW/INDEX/SYN/CLUSTER</p><h2 id=12-数据操纵语言dmldata-manipulation-language><a href=#12-%e6%95%b0%e6%8d%ae%e6%93%8d%e7%ba%b5%e8%af%ad%e8%a8%80dmldata-manipulation-language>#</a>
1.2 数据操纵语言DML（Data Manipulation Language）</h2><p>​ 数据操纵语言DML主要有三种形式：</p><ol><li>插入：INSERT</li><li>更新：UPDATE</li><li>删除：DELETE</li></ol><h2 id=13-数据查询语言dqldata-querylanguage><a href=#13-%e6%95%b0%e6%8d%ae%e6%9f%a5%e8%af%a2%e8%af%ad%e8%a8%80dqldata-querylanguage>#</a>
1.3 数据查询语言DQL（Data QueryLanguage）</h2><p>​ 数据查询语言DQL基本结构是由SELECT子句，FROM子句，WHERE子句组成的查询块：</p><ol><li><p>SELECT &lt;字段名表></p></li><li><p>FROM &lt;表或视图名></p></li><li><p>WHERE &lt;查询条件></p></li></ol><h2 id=14-数据控制语言dcldata-control-language><a href=#14-%e6%95%b0%e6%8d%ae%e6%8e%a7%e5%88%b6%e8%af%ad%e8%a8%80dcldata-control-language>#</a>
1.4 数据控制语言DCL（Data Control Language）</h2><p>数据控制语言DCL用来授予或回收访问数据库的某种特权，并控制数据库操纵事务发生的时间及效果，对数据库实行监视等。如：</p><ol><li><p>GRANT：授权。</p></li><li><p>ROLLBACK [WORK] TO [SAVEPOINT]：回退到某一点。</p></li><li><p>COMMIT [WORK]：提交。</p><p>​ 在数据库的插入、删除和修改操作时，只有当事务在提交到数据库时才算完成。在事务提交前，只有操作数据库的这个人才能有权看到所做的事情，别人只有在最后提交完成后才可以看到。提交数据有三种类型：显式提交、隐式提交及自动提交。下面分别说明这三种类型。</p><p>(1) 显式提交用COMMIT命令直接完成的提交为显式提交。其格式为：SQL>COMMIT；</p><p>(2) 隐式提交用SQL命令间接完成的提交为隐式提交。这些命令是：ALTER，AUDIT，COMMENT，CONNECT，CREATE，DISCONNECT，DROP，EXIT，GRANT，NOAUDIT，QUIT，REVOKE，RENAME。</p><p>(3) 自动提交若把AUTOCOMMIT设置为ON，则在插入、修改、删除语句执行后，系统将自动进行提交，这就是自动提交。其格式为：SQL>SET AUTOCOMMIT ON；</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>show命令</span><span class=err>：</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>show</span><span class=w> </span><span class=n>databases</span><span class=p>;</span><span class=w>  </span><span class=c1>-- 查询所有的数据库
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>show</span><span class=w> </span><span class=n>tables</span><span class=p>;</span><span class=w> </span><span class=c1>-- 查询所有的数据表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>show</span><span class=w> </span><span class=n>engines</span><span class=w> </span><span class=c1>-- 查询数据库支持的存储引擎
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>show</span><span class=w> </span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=p>;</span><span class=w> </span><span class=c1>-- 查看创建表语句
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>show</span><span class=w> </span><span class=n>variables</span><span class=w> </span><span class=c1>-- 查询系统变量及其值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>show</span><span class=w> </span><span class=n>variables</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>&#39;变量名&#39;</span><span class=w> </span><span class=c1>-- 查询某个系统变量
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>show</span><span class=w> </span><span class=n>tables</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=err>库名</span><span class=w> </span><span class=c1>-- 查询指定数据库的表
</span></span></span></code></pre></div><p><code>SELECT VERSION(); -- 查看服务器版本</code></p><h2 id=15-mysql体系结构><a href=#15-mysql%e4%bd%93%e7%b3%bb%e7%bb%93%e6%9e%84>#</a>
1.5 MySQL体系结构</h2><h3 id=151-mysql服务端的4层结构><a href=#151-mysql%e6%9c%8d%e5%8a%a1%e7%ab%af%e7%9a%844%e5%b1%82%e7%bb%93%e6%9e%84>#</a>
1.5.1 MySQL服务端的4层结构</h3><ol><li>连接层</li><li>服务层</li><li>引擎层</li><li>存储层</li></ol><p><img src=/p/mysql-basic/assets/image-20231101102755253.png width=993 height=737 srcset="/p/mysql-basic/assets/image-20231101102755253_hu1797017a6a7288adc1b88ab8a44e7fe5_197255_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231101102755253_hu1797017a6a7288adc1b88ab8a44e7fe5_197255_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231101102755253 class=gallery-image data-flex-grow=134 data-flex-basis=323px></p><h1 id=2-数据定义语言ddl><a href=#2-%e6%95%b0%e6%8d%ae%e5%ae%9a%e4%b9%89%e8%af%ad%e8%a8%80ddl>#</a>
2. 数据定义语言DDL</h1><p>库和表的管理</p><ul><li>创建：create</li><li>修改：alter</li><li>删除：drop</li></ul><h2 id=21-创建create><a href=#21-%e5%88%9b%e5%bb%bacreate>#</a>
2.1 创建（Create）</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>创建数据库设置字符集</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=n>test</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=nb>CHARACTER</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>utf8mb4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>案例：库的创建，如果不存在则创建</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>test</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>案例创建表</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=err>表名</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>。。。。。。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h2 id=22-修改alter><a href=#22-%e4%bf%ae%e6%94%b9alter>#</a>
2.2 修改（Alter）</h2><h3 id=221-库的修改><a href=#221-%e5%ba%93%e7%9a%84%e4%bf%ae%e6%94%b9>#</a>
2.2.1 库的修改</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>更改库的字符集</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=err>库名</span><span class=w> </span><span class=nb>CHARACTER</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>utf8mb4</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=222-表的修改><a href=#222-%e8%a1%a8%e7%9a%84%e4%bf%ae%e6%94%b9>#</a>
2.2.2 表的修改</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=mi>1</span><span class=p>.</span><span class=w> </span><span class=err>修改列名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=n>CHANGE</span><span class=w> </span><span class=k>COLUMN</span><span class=w> </span><span class=err>旧列名</span><span class=w> </span><span class=err>新列名</span><span class=w> </span><span class=err>数据类型</span><span class=p>;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=mi>2</span><span class=p>.</span><span class=w> </span><span class=err>修改列的类型或约束</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>MODIFY</span><span class=w> </span><span class=k>COLUMN</span><span class=w> </span><span class=err>列名</span><span class=w> </span><span class=err>新数据类型</span><span class=p>;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=mi>3</span><span class=p>.</span><span class=w> </span><span class=err>添加新列</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=k>COLUMN</span><span class=w> </span><span class=err>列名</span><span class=w> </span><span class=err>数据类型</span><span class=w> </span><span class=err>【</span><span class=k>first</span><span class=o>|</span><span class=k>after</span><span class=w> </span><span class=err>列名】</span><span class=p>;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=mi>4</span><span class=p>.</span><span class=w> </span><span class=err>删除列</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>DROP</span><span class=w> </span><span class=k>COLUMN</span><span class=w> </span><span class=err>列名</span><span class=p>;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=mi>5</span><span class=p>.</span><span class=w> </span><span class=err>修改表名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>RENAME</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=err>新表名</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=23-删除drop><a href=#23-%e5%88%a0%e9%99%a4drop>#</a>
2.3 删除（Drop）</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=mi>1</span><span class=p>.</span><span class=w> </span><span class=err>库的删除</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DROP</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=err>库名</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=mi>2</span><span class=p>.</span><span class=w> </span><span class=err>表的删除</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=err>表名</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=24-复制create><a href=#24-%e5%a4%8d%e5%88%b6create>#</a>
2.4 复制（Create）</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=mi>1</span><span class=p>.</span><span class=w> </span><span class=err>仅仅复制表的结构</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>新表名</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=err>表名</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>2</span><span class=p>.</span><span class=w> </span><span class=err>复制表的结构</span><span class=o>+</span><span class=err>数据</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>新表名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=err>表名</span><span class=p>;</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=p>(</span><span class=err>通过查询语句也可以选择性建表</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><h2 id=25-六大约束><a href=#25-%e5%85%ad%e5%a4%a7%e7%ba%a6%e6%9d%9f>#</a>
2.5 六大约束</h2><ol><li>**NOT NULL：**非空约束，用于保证该字段的值不能为空比如：姓名、学号等。</li><li>**DEFAULT：**默认值约束，用于保证该字段有默认值比如：性别。</li><li>PRIMARY KEY：主键约束，用于保证该字段的值具有唯一性，并且非空比如：学号、员工编号等。</li><li>**UNIQUE：**唯一性约束，用于保证该字段的值具有唯一性，可以为空比如：座位号。</li><li>CHECK：检查约束【mysql中不支持，不报错但没有效果】。</li><li>FOREIGN KEY：外键约束，用于限制两个表的关系，用于保证该字段的值必须来自于主表的关联列的值。比如：学生表的专业编号，员工表的部门编号，员工表的工种编号。</li></ol><h3 id=251-约束的添加分类><a href=#251-%e7%ba%a6%e6%9d%9f%e7%9a%84%e6%b7%bb%e5%8a%a0%e5%88%86%e7%b1%bb>#</a>
2.5.1 约束的添加分类</h3><ol><li>列级分类</li></ol><p>六大约束语法上都支持，但外键约束没有效果。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>stuinfo</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>id</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=o>#</span><span class=err>主键约束</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>stuName</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=o>#</span><span class=err>非空约束</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>gender</span><span class=w> </span><span class=nb>CHAR</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=k>CHECK</span><span class=p>(</span><span class=n>gender</span><span class=o>=</span><span class=s1>&#39;男&#39;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>gender</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;女&#39;</span><span class=p>),</span><span class=o>#</span><span class=err>检查约束</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>seat</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>UNIQUE</span><span class=p>,</span><span class=o>#</span><span class=err>唯一性约束</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>age</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>18</span><span class=p>,</span><span class=o>#</span><span class=w> </span><span class=err>默认值约束</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>majorId</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=n>major</span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=o>#</span><span class=err>外键约束</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w> 
</span></span></span></code></pre></div><ol start=2><li><p>表级分类</p><p>除了非空约束、默认值约束，其他的都支持。</p></li></ol><p><strong>外键：</strong></p><ol><li>要求在从表设置外键关系。</li><li>从表外键列的类型和主表的关联列的类型要求一致或兼容，名称无要求。</li><li>主表的关联列必须是一个key（一般是主键或唯一）。</li><li>插入数据时，先插入主表，再插入从表。</li><li>删除数据时，先删除从表，再删除主表。</li></ol><h3 id=252-修改表时添加约束><a href=#252-%e4%bf%ae%e6%94%b9%e8%a1%a8%e6%97%b6%e6%b7%bb%e5%8a%a0%e7%ba%a6%e6%9d%9f>#</a>
2.5.2 修改表时添加约束</h3><ol><li><p>添加非空约束</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>MODIFY</span><span class=w> </span><span class=k>COLUMN</span><span class=w> </span><span class=err>列名</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div></li><li><p>添加默认值约束</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>MODIFY</span><span class=w> </span><span class=k>COLUMN</span><span class=w> </span><span class=err>列名</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>18</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div></li><li><p>添加主键约束</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>①列级约束</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>MODIFY</span><span class=w> </span><span class=k>COLUMN</span><span class=w> </span><span class=err>列名</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>②表级约束</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=err>列名</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=err>键名</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=err>列名</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div></li><li><p>添加唯一性约束</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>①列级约束</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>MODIFY</span><span class=w> </span><span class=k>COLUMN</span><span class=w> </span><span class=err>列名</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>UNIQUE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>②表级约束</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=k>UNIQUE</span><span class=p>(</span><span class=err>列名</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=err>键名</span><span class=w> </span><span class=k>UNIQUE</span><span class=p>(</span><span class=err>列名</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div></li><li><p>添加外键约束</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>ADD</span><span class=w> </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=err>键名</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=p>(</span><span class=err>列名</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=err>表名</span><span class=p>(</span><span class=err>列名</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div></li></ol><h3 id=253-修改表时删除约束><a href=#253-%e4%bf%ae%e6%94%b9%e8%a1%a8%e6%97%b6%e5%88%a0%e9%99%a4%e7%ba%a6%e6%9d%9f>#</a>
2.5.3 修改表时删除约束</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=mi>1</span><span class=p>.</span><span class=w> </span><span class=err>删除非空约束</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>MODIFY</span><span class=w> </span><span class=k>COLUMN</span><span class=w> </span><span class=err>列名</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NULL</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>2</span><span class=p>.</span><span class=w> </span><span class=err>删除默认值约束</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>MODIFY</span><span class=w> </span><span class=k>COLUMN</span><span class=w> </span><span class=err>列名</span><span class=w> </span><span class=nb>INT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>3</span><span class=p>.</span><span class=w> </span><span class=err>删除主键约束</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>DROP</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>4</span><span class=p>.</span><span class=w> </span><span class=err>删除唯一性约束</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>DROP</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=err>键名</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>5</span><span class=p>.</span><span class=w> </span><span class=err>删除外键约束</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>DROP</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=err>外键名</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h1 id=3-数据操纵语言dml><a href=#3-%e6%95%b0%e6%8d%ae%e6%93%8d%e7%ba%b5%e8%af%ad%e8%a8%80dml>#</a>
3. 数据操纵语言DML</h1><p>数据操作语言</p><ul><li>插入：insert</li><li>修改：update</li><li>删除：delete</li></ul><h2 id=31-插入语句insert><a href=#31-%e6%8f%92%e5%85%a5%e8%af%ad%e5%8f%a5insert>#</a>
3.1 插入语句Insert</h2><ul><li>方式一</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=p>(</span><span class=err>列名</span><span class=p>,......)</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=err>值</span><span class=mi>1</span><span class=p>,......)</span><span class=w>
</span></span></span></code></pre></div><ul><li>方式二</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=err>表名</span><span class=k>set</span><span class=w> </span><span class=err>列名</span><span class=o>=</span><span class=err>值</span><span class=p>,</span><span class=err>列名</span><span class=o>=</span><span class=err>值</span><span class=p>,......</span><span class=w>
</span></span></span></code></pre></div><p>两种方式比较：</p><ol><li>方式一支持插入多行，方式二不支持</li><li>方式一支持子查询，方式二不支持</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=err>查询的结果对应插入到表中</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>beauty</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=n>NAME</span><span class=p>,</span><span class=n>phone</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=mi>26</span><span class=p>,</span><span class=s1>&#39;宋茜&#39;</span><span class=p>,</span><span class=s1>&#39;118&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=32-修改语句update><a href=#32-%e4%bf%ae%e6%94%b9%e8%af%ad%e5%8f%a5update>#</a>
3.2 修改语句Update</h2><blockquote><p>常规用法</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>update</span><span class=w> </span><span class=err>表名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>set</span><span class=w> </span><span class=err>列</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=err>新值</span><span class=p>,......</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=err>筛选条件</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>修改多表操作</p></blockquote><p><strong>sql92语法：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>update</span><span class=w> </span><span class=err>表</span><span class=mi>1</span><span class=w> </span><span class=err>别名</span><span class=p>,</span><span class=err>表</span><span class=mi>2</span><span class=w> </span><span class=err>别名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>set</span><span class=w> </span><span class=err>列</span><span class=o>=</span><span class=err>值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=err>连接条件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=err>筛选条件</span><span class=w>
</span></span></span></code></pre></div><p><strong>sql99语法：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>update</span><span class=w> </span><span class=err>表</span><span class=mi>1</span><span class=w> </span><span class=err>别名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>【连接类型】</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=err>表名</span><span class=mi>2</span><span class=w> </span><span class=err>别名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>on</span><span class=w> </span><span class=err>连接条件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>set</span><span class=w> </span><span class=err>列</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=err>值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=err>筛选条件</span><span class=w>
</span></span></span></code></pre></div><h2 id=33-删除语句delete><a href=#33-%e5%88%a0%e9%99%a4%e8%af%ad%e5%8f%a5delete>#</a>
3.3 删除语句Delete</h2><h3 id=331-方式一><a href=#331-%e6%96%b9%e5%bc%8f%e4%b8%80>#</a>
3.3.1 方式一</h3><blockquote><p>单表的删除【掌握】</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>delete</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=err>筛选条件</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>多表的删除【补充】</p></blockquote><p><strong>sql92语法：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>delete</span><span class=w> </span><span class=err>表</span><span class=mi>1</span><span class=err>的别名</span><span class=p>,</span><span class=err>表</span><span class=mi>2</span><span class=err>的别名（删除谁的填谁的，都删都填）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=err>表</span><span class=mi>1</span><span class=w> </span><span class=err>别名</span><span class=p>,</span><span class=err>表</span><span class=mi>2</span><span class=w> </span><span class=err>别名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=err>连接条件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>and</span><span class=w> </span><span class=err>筛选条件</span><span class=w>
</span></span></span></code></pre></div><p><strong>sql99语法：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>delete</span><span class=w> </span><span class=err>表</span><span class=mi>1</span><span class=err>的别名</span><span class=p>,</span><span class=err>表</span><span class=mi>2</span><span class=err>的别名（删除谁的填谁的，都删都填）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=err>表</span><span class=mi>1</span><span class=w> </span><span class=err>别名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>【连接类型】</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=err>表</span><span class=mi>2</span><span class=w> </span><span class=err>别名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>on</span><span class=w> </span><span class=err>连接条件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=err>筛选条件</span><span class=w>
</span></span></span></code></pre></div><p><strong>案例</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=err>案例：删除黄晓明的信息以及他女朋友的信息</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DELETE</span><span class=w> </span><span class=n>be</span><span class=p>,</span><span class=n>bo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>beauty</span><span class=w> </span><span class=n>be</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>JOIN</span><span class=w> </span><span class=n>boys</span><span class=w> </span><span class=n>bo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ON</span><span class=w> </span><span class=n>be</span><span class=p>.</span><span class=o>`</span><span class=n>boyfriend_id</span><span class=o>`</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bo</span><span class=p>.</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>bo</span><span class=p>.</span><span class=o>`</span><span class=n>boyName</span><span class=o>`</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;黄晓明&#39;</span><span class=w>
</span></span></span></code></pre></div><h3 id=332-方式二><a href=#332-%e6%96%b9%e5%bc%8f%e4%ba%8c>#</a>
3.3.2 方式二</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>trunecat</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=err>表名</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=err>清空数据</span><span class=w>
</span></span></span></code></pre></div><p><strong>说明：</strong></p><ol><li><p>自增长列重新开始计数。</p></li><li><p>没有返回值。</p></li><li><p>不能回滚。</p></li></ol><h1 id=4-数据库查询语言dql><a href=#4-%e6%95%b0%e6%8d%ae%e5%ba%93%e6%9f%a5%e8%af%a2%e8%af%ad%e8%a8%80dql>#</a>
4. 数据库查询语言DQL</h1><h2 id=41-基础查询><a href=#41-%e5%9f%ba%e7%a1%80%e6%9f%a5%e8%af%a2>#</a>
4.1 基础查询</h2><p><strong>语法：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=err>查询列表</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=err>表名</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p><strong>特点：</strong></p><ul><li>查询列表可以是：表中的字段、常量值、表达式、函数。</li><li>查询的结果是一个虚拟的表格。</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>查询常量值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=mi>100</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=s1>&#39;john&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>查询表达式</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w>	</span><span class=mi>100</span><span class=o>%</span><span class=mi>98</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>查询函数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>VERSION</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>起别名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w>	</span><span class=mi>100</span><span class=o>%</span><span class=mi>98</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s2>&#34;结果&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=mi>100</span><span class=o>%</span><span class=mi>98</span><span class=w> </span><span class=s2>&#34;结果&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>去重</span><span class=p>(</span><span class=k>DISTINCT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>DISTINCT</span><span class=w> </span><span class=n>department_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=err>号的作用</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=o>#</span><span class=w> </span><span class=n>mysql中的</span><span class=o>+</span><span class=err>号：</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=o>#</span><span class=w> </span><span class=err>仅仅只有一个功能：运算符</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=mi>123</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>90</span><span class=p>;</span><span class=w>  </span><span class=err>两个操作数都为数值型，则做加法运算</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=s1>&#39;123&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>90</span><span class=p>;</span><span class=w>  </span><span class=err>其中一方为字符</span><span class=w> </span><span class=err>型，试图将字符型数值转换成数值型</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=o>#</span><span class=w> </span><span class=err>如果转换成功，则继续做加法运算</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=s1>&#39;john&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>90</span><span class=p>;</span><span class=w> </span><span class=err>如果转换失败，则将字符型数值转换成</span><span class=mi>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=k>null</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>  </span><span class=err>只要其中一方为</span><span class=k>null</span><span class=err>，则结果肯定为</span><span class=k>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=n>CONCAT</span><span class=p>()</span><span class=err>函数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>CONCAT</span><span class=p>(</span><span class=n>last_name</span><span class=p>,</span><span class=n>first_name</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s2>&#34;姓名&#34;</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>注：只要其中一方为</span><span class=k>null</span><span class=err>，则结果肯定为</span><span class=k>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=n>IFNULL</span><span class=p>(</span><span class=err>字段名</span><span class=p>,</span><span class=err>替换值</span><span class=p>)</span><span class=err>函数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>功能：如果为</span><span class=k>null</span><span class=err>，结果则替换为后一个参数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=k>ISNULL</span><span class=p>(</span><span class=err>字段</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>功能：判断某字段或表达式是否为</span><span class=k>null</span><span class=err>，如果是则返回</span><span class=mi>1</span><span class=err>，否则返回</span><span class=mi>0</span><span class=w>
</span></span></span></code></pre></div><h2 id=42-条件查询><a href=#42-%e6%9d%a1%e4%bb%b6%e6%9f%a5%e8%af%a2>#</a>
4.2 条件查询</h2><p><strong>语法：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=err>③</span><span class=k>select</span><span class=w> </span><span class=err>查询列表</span><span class=w> </span><span class=err>①</span><span class=k>from</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=err>②</span><span class=k>where</span><span class=w> </span><span class=err>筛选条件</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p><strong>分类：</strong></p><ol><li><p>按条件表达式筛选(=或&lt;>不能判断null值)</p><ul><li>条件运算符：>、&lt;、=、!=、&lt;>、>=、&lt;=、&lt;=>。<ul><li>&lt;=>安全等于：既可以判断null值又可以判断普通值</li></ul></li></ul></li><li><p>按逻辑表达式筛选</p><ul><li>逻辑运算符：and、or、not。</li></ul></li><li><p>模糊查询</p><ul><li><p>like</p><ul><li><p>通配符：</p><ul><li><p>% 任意一个字符（包含0个）</p></li><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=w>  </span><span class=err>转义</span><span class=k>WHERE</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=s1>&#39;_$_%&#39;</span><span class=w> </span><span class=k>ESCAPE</span><span class=w> </span><span class=s1>&#39;$&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div></li><li><p>可以判断字符型和数值型</p></li></ul></li></ul></li><li><p>between and</p><ul><li>包含临界值</li></ul></li><li><p>in</p><ul><li>判断某字段的值是否属于in列表中的某一项</li><li>in列表的值类型必须一致或兼容</li></ul></li><li><p>is null 和is not null</p></li></ul></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>查询员工表的</span><span class=n>job_id中包含a和e的</span><span class=err>，并且</span><span class=n>a在e的前面</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>job_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>job_id</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=s1>&#39;%a%e%&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=43-排序查询><a href=#43-%e6%8e%92%e5%ba%8f%e6%9f%a5%e8%af%a2>#</a>
4.3 排序查询</h2><p><strong>语法：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=err>③</span><span class=k>select</span><span class=w> </span><span class=err>查询列表</span><span class=w> </span><span class=err>①</span><span class=k>from</span><span class=w> </span><span class=err>表</span><span class=w> </span><span class=err>【②</span><span class=k>where</span><span class=w> </span><span class=err>筛选条件】④</span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=err>排序列表</span><span class=w> </span><span class=err>【</span><span class=k>asc</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>desc</span><span class=err>】</span><span class=w>
</span></span></span></code></pre></div><p>特点：</p><ul><li>默认是升序。</li><li>order by 子句中可以支持单个字段、多个字段、表达式、函数、别名。</li><li>order by 子句一般是放在查询语句的最后面，limit子句除外。</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>按姓名的长度显示员工的姓名和工资（按函数排序）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>LENGTH</span><span class=p>(</span><span class=n>last_name</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=err>姓名长度</span><span class=p>,</span><span class=n>last_name</span><span class=p>,</span><span class=n>salary</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=err>姓名长度</span><span class=w> </span><span class=k>DESC</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>查询员工信息，要求先按工资升序，在按员工编号降序（按多个字段排序）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>salary</span><span class=w> </span><span class=k>ASC</span><span class=p>,</span><span class=n>employee_id</span><span class=w> </span><span class=k>DESC</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=44-常见函数><a href=#44-%e5%b8%b8%e8%a7%81%e5%87%bd%e6%95%b0>#</a>
4.4 常见函数</h2><p><strong>调用：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=err>函数名</span><span class=p>(</span><span class=err>实参列表</span><span class=p>)</span><span class=w> </span><span class=err>【</span><span class=n>from表</span><span class=err>】</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p><strong>分类：</strong></p><ul><li>单行函数（concat、length、ifnull等）</li><li>分组函数<ul><li>功能：做统计使用，又称为统计函数、聚合函数、组函数</li></ul></li></ul><h3 id=441-单行函数-字符函数><a href=#441-%e5%8d%95%e8%a1%8c%e5%87%bd%e6%95%b0-%e5%ad%97%e7%ac%a6%e5%87%bd%e6%95%b0>#</a>
4.4.1 单行函数-字符函数</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=mi>1</span><span class=p>.</span><span class=w> </span><span class=k>length</span><span class=w> </span><span class=err>获取参数值的字节个数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>LENGTH</span><span class=p>(</span><span class=s1>&#39;jon&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>2</span><span class=p>.</span><span class=w> </span><span class=n>concat</span><span class=w> </span><span class=err>拼接字符串</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>CONCAT</span><span class=p>(</span><span class=n>last_name</span><span class=p>,</span><span class=s1>&#39;_&#39;</span><span class=p>,</span><span class=n>first_name</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s2>&#34;姓名&#34;</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>3</span><span class=p>.</span><span class=w> </span><span class=n>upper大写</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>UPPER</span><span class=p>(</span><span class=s1>&#39;john&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>4</span><span class=p>.</span><span class=w> </span><span class=k>lower</span><span class=w> </span><span class=err>小写</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>LOWER</span><span class=p>(</span><span class=s1>&#39;John&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>5</span><span class=p>.</span><span class=w> </span><span class=n>substr或者substring截取字符串</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>注意：索引从</span><span class=mi>1</span><span class=err>开始的</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>截取从指定索引处后面所有字符</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>SUBSTR</span><span class=p>(</span><span class=s1>&#39;测试数据123&#39;</span><span class=p>,</span><span class=mi>2</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s2>&#34;out_put&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>截取从指定索引处指定字符长度的字符</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>SUBSTR</span><span class=p>(</span><span class=s1>&#39;测试数据123&#39;</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>3</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s2>&#34;out_put&#34;</span><span class=p>;</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>从</span><span class=mi>1</span><span class=err>开始向后截取三位</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>===================</span><span class=err>案例</span><span class=o>=====================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>姓名中首字符大写，其他字符小写然后用</span><span class=n>_拼接</span><span class=err>，显示出来</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>CONCAT</span><span class=p>(</span><span class=k>UPPER</span><span class=p>(</span><span class=n>SUBSTR</span><span class=p>(</span><span class=n>first_name</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)),</span><span class=k>LOWER</span><span class=p>(</span><span class=n>SUBSTR</span><span class=p>(</span><span class=n>first_name</span><span class=p>,</span><span class=mi>2</span><span class=p>)),</span><span class=s1>&#39;_&#39;</span><span class=p>,</span><span class=k>LOWER</span><span class=p>(</span><span class=n>last_name</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>6</span><span class=p>.</span><span class=w> </span><span class=n>instr</span><span class=w> </span><span class=err>返回参数第一次出现的索引，如果找不到返回</span><span class=mi>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>INSTR</span><span class=p>(</span><span class=s1>&#39;12345678&#39;</span><span class=p>,</span><span class=s1>&#39;678&#39;</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s2>&#34;out_put&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>7</span><span class=p>.</span><span class=w> </span><span class=k>trim</span><span class=w> </span><span class=err>去除前后空格或者指定字符</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>TRIM</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=s1>&#39;a张a三a&#39;</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s2>&#34;out_put&#34;</span><span class=p>;</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>结果：张</span><span class=n>a三</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>8</span><span class=p>.</span><span class=w> </span><span class=n>lpad</span><span class=w> </span><span class=err>用指定字符实现指定长度的左填充</span><span class=p>,</span><span class=err>如果指定长度小于字符则会截断</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>LPAD</span><span class=p>(</span><span class=s1>&#39;测试&#39;</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=s1>&#39;*&#39;</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s2>&#34;out_put&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>9</span><span class=p>.</span><span class=w> </span><span class=n>rpad</span><span class=w> </span><span class=err>用指定字符实现指定长度的右填充</span><span class=p>,</span><span class=err>如果指定长度小于字符则会截断</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>RPAD</span><span class=p>(</span><span class=s1>&#39;测试&#39;</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=s1>&#39;*&#39;</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s2>&#34;out_put&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>===========================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>10</span><span class=p>.</span><span class=w> </span><span class=k>replace</span><span class=w> </span><span class=err>全部替换</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>REPLACE</span><span class=p>(</span><span class=s1>&#39;66&#39;</span><span class=p>,</span><span class=s1>&#39;66&#39;</span><span class=p>,</span><span class=s1>&#39;88&#39;</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s2>&#34;out_put&#34;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=442-单行函数-数学函数><a href=#442-%e5%8d%95%e8%a1%8c%e5%87%bd%e6%95%b0-%e6%95%b0%e5%ad%a6%e5%87%bd%e6%95%b0>#</a>
4.4.2 单行函数-数学函数</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=mi>1</span><span class=p>.</span><span class=w> </span><span class=n>round</span><span class=w> </span><span class=err>四舍五入</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>ROUND</span><span class=p>(</span><span class=mi>1</span><span class=p>.</span><span class=mi>65</span><span class=p>);</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>结果：</span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>ROUND</span><span class=p>(</span><span class=mi>1</span><span class=p>.</span><span class=mi>65</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>小数点后面保留</span><span class=mi>1</span><span class=err>位</span><span class=p>:</span><span class=mi>1</span><span class=p>.</span><span class=mi>7</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>2</span><span class=p>.</span><span class=w> </span><span class=n>ceil</span><span class=w> </span><span class=err>向上取整</span><span class=p>,</span><span class=err>返回</span><span class=o>&gt;=</span><span class=err>该参数的最小整数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>CEIL</span><span class=p>(</span><span class=mi>1</span><span class=p>.</span><span class=mi>02</span><span class=p>);</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>结果：</span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>CEIL</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>.</span><span class=mi>02</span><span class=p>);</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>结果：</span><span class=o>-</span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>3</span><span class=p>.</span><span class=w> </span><span class=n>floor</span><span class=w> </span><span class=err>向下取整，返回</span><span class=o>&lt;=</span><span class=err>该参数的最大整数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>FLOOR</span><span class=p>(</span><span class=mi>9</span><span class=p>.</span><span class=mi>99</span><span class=p>);</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>结果：</span><span class=mi>9</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>FLOOR</span><span class=p>(</span><span class=o>-</span><span class=mi>9</span><span class=p>.</span><span class=mi>99</span><span class=p>);</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>结果：</span><span class=o>-</span><span class=mi>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>4</span><span class=p>.</span><span class=w> </span><span class=k>truncate</span><span class=w> </span><span class=err>截断</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>TRUNCATE</span><span class=p>(</span><span class=mi>1</span><span class=p>.</span><span class=mi>6999</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>结果：</span><span class=mi>1</span><span class=p>.</span><span class=mi>6</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>5</span><span class=p>.</span><span class=w> </span><span class=k>mod</span><span class=w> </span><span class=err>取余</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=k>mod</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>)</span><span class=err>：公式：</span><span class=n>a</span><span class=o>-</span><span class=n>b</span><span class=o>/</span><span class=n>b</span><span class=o>*</span><span class=n>b</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>MOD</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span><span class=mi>3</span><span class=p>);</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>结果：</span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>MOD</span><span class=p>(</span><span class=o>-</span><span class=mi>10</span><span class=p>,</span><span class=mi>3</span><span class=p>);</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>结果：</span><span class=o>-</span><span class=mi>1</span><span class=w>
</span></span></span></code></pre></div><h3 id=443-单行函数-日期函数><a href=#443-%e5%8d%95%e8%a1%8c%e5%87%bd%e6%95%b0-%e6%97%a5%e6%9c%9f%e5%87%bd%e6%95%b0>#</a>
4.4.3 单行函数-日期函数</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=mi>1</span><span class=p>.</span><span class=w> </span><span class=n>now</span><span class=p>()</span><span class=w> </span><span class=err>返回当前系统日期</span><span class=o>+</span><span class=err>时间</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>NOW</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>2</span><span class=p>.</span><span class=w> </span><span class=n>curdate</span><span class=p>()</span><span class=w> </span><span class=err>返回当前系统日期</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>CURDATE</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>3</span><span class=p>.</span><span class=w> </span><span class=n>curtime</span><span class=p>()</span><span class=w> </span><span class=err>返回当前时间</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>CURTIME</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>4</span><span class=p>.</span><span class=w> </span><span class=err>获取指定的部分，年、月、日、小时、分钟、秒</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>YEAR</span><span class=p>(</span><span class=n>NOW</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>MONTH</span><span class=p>(</span><span class=n>NOW</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>DAY</span><span class=p>(</span><span class=n>NOW</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>HOUR</span><span class=p>(</span><span class=n>NOW</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>MINUTE</span><span class=p>(</span><span class=n>NOW</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>SECOND</span><span class=p>(</span><span class=n>NOW</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>5</span><span class=p>.</span><span class=w> </span><span class=n>str_to_date</span><span class=w> </span><span class=err>将字符</span><span class=w> </span><span class=err>指定的格式转换成日期</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>hiredate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>STR_TO_DATE</span><span class=p>(</span><span class=s1>&#39;4-3 1992&#39;</span><span class=p>,</span><span class=s1>&#39;%c-%d %Y&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>6</span><span class=p>.</span><span class=w> </span><span class=n>date_formart</span><span class=w> </span><span class=err>将日期转换为字符串</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>DATE_FORMAT</span><span class=p>(</span><span class=n>NOW</span><span class=p>(),</span><span class=s1>&#39;%y年%m月%d日&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>7</span><span class=p>.</span><span class=w> </span><span class=n>datediff</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>DATEDIFF</span><span class=p>(</span><span class=n>NOW</span><span class=p>(),</span><span class=s1>&#39;1997-01-01&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h3 id=444-单行函数-流程控制函数><a href=#444-%e5%8d%95%e8%a1%8c%e5%87%bd%e6%95%b0-%e6%b5%81%e7%a8%8b%e6%8e%a7%e5%88%b6%e5%87%bd%e6%95%b0>#</a>
4.4.4 单行函数-流程控制函数</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=mi>1</span><span class=p>.</span><span class=w> </span><span class=n>if函数</span><span class=p>(</span><span class=err>类似于三目运算符</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>IF</span><span class=p>(</span><span class=mi>10</span><span class=o>&gt;</span><span class=mi>5</span><span class=p>,</span><span class=s2>&#34;大&#34;</span><span class=p>,</span><span class=s2>&#34;小&#34;</span><span class=p>);</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>结果：大</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>last_name</span><span class=p>,</span><span class=n>commission_pct</span><span class=p>,</span><span class=k>IF</span><span class=p>(</span><span class=n>commission_pct</span><span class=w> </span><span class=k>IS</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=s1>&#39;没奖金&#39;</span><span class=p>,</span><span class=s1>&#39;有奖金&#39;</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s2>&#34;备注&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>2</span><span class=p>.</span><span class=w> </span><span class=n>case函数的使用一</span><span class=err>：</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>语法：</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>CASE</span><span class=w> </span><span class=err>要判断的字段或表达式</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>WHEN</span><span class=w> </span><span class=err>常量</span><span class=mi>1</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=err>要显示的值</span><span class=mi>1</span><span class=err>或语句</span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>WHEN</span><span class=w> </span><span class=err>常量</span><span class=mi>2</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=err>要显示的值</span><span class=mi>2</span><span class=err>或语句</span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>ELSE</span><span class=w> </span><span class=err>要显示的值</span><span class=n>n或语句n</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>END</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>案例：查询员工的工资，要求</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w>	</span><span class=err>部门号</span><span class=o>=</span><span class=mi>30</span><span class=err>，显示的工资为</span><span class=mi>1</span><span class=p>.</span><span class=mi>1</span><span class=err>倍</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w>	</span><span class=err>部门号</span><span class=o>=</span><span class=mi>40</span><span class=err>，显示的工资为</span><span class=mi>1</span><span class=p>.</span><span class=mi>2</span><span class=err>倍</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w>	</span><span class=err>部门号</span><span class=o>=</span><span class=mi>50</span><span class=err>，显示的工资为</span><span class=mi>1</span><span class=p>.</span><span class=mi>3</span><span class=err>倍</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w>	</span><span class=err>其他部门，显示的工资为原工资</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>salary</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s2>&#34;原始工资&#34;</span><span class=p>,</span><span class=n>department_id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CASE</span><span class=w> </span><span class=n>department_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHEN</span><span class=w> </span><span class=mi>30</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=n>salary</span><span class=o>*</span><span class=mi>1</span><span class=p>.</span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHEN</span><span class=w> </span><span class=mi>40</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=n>salary</span><span class=o>*</span><span class=mi>1</span><span class=p>.</span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHEN</span><span class=w> </span><span class=mi>50</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=n>salary</span><span class=o>*</span><span class=mi>1</span><span class=p>.</span><span class=mi>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ELSE</span><span class=w> </span><span class=n>salary</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s2>&#34;新工资&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>============================================</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>3</span><span class=p>.</span><span class=w> </span><span class=n>case函数的使用二</span><span class=err>：类似于多重</span><span class=k>if</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>语法：</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>CASE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>WHEN</span><span class=w> </span><span class=err>条件</span><span class=mi>1</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=err>要显示的值</span><span class=mi>1</span><span class=err>或语句</span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>WHEN</span><span class=w> </span><span class=err>条件</span><span class=mi>2</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=err>要</span><span class=w>  </span><span class=err>显示的值</span><span class=mi>2</span><span class=err>或语句</span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>ELSE</span><span class=w> </span><span class=err>要显示的值</span><span class=n>n或语句n</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>END</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>案例：查询员工的工资情况</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>如果工资</span><span class=o>&gt;</span><span class=mi>20000</span><span class=p>,</span><span class=err>显示</span><span class=n>A级别</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>如果工资</span><span class=o>&gt;</span><span class=mi>15000</span><span class=p>,</span><span class=err>显示</span><span class=n>B级别</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>如果工资</span><span class=o>&gt;</span><span class=mi>10000</span><span class=p>,</span><span class=err>显示</span><span class=n>C级别</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>否则，显示</span><span class=n>D级别</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>salary</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CASE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHEN</span><span class=w> </span><span class=n>salary</span><span class=o>&gt;</span><span class=mi>20000</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>&#39;A级别&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHEN</span><span class=w> </span><span class=n>salary</span><span class=o>&gt;</span><span class=mi>15000</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>&#39;B级别&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHEN</span><span class=w> </span><span class=n>salary</span><span class=o>&gt;</span><span class=mi>10000</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>&#39;C级别&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ELSE</span><span class=w> </span><span class=s1>&#39;D级别&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s2>&#34;工资级别&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>fromv</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>employees</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=445-分组函数><a href=#445-%e5%88%86%e7%bb%84%e5%87%bd%e6%95%b0>#</a>
4.4.5 分组函数</h3><p><strong>分类：</strong></p><p>​ sum 求和、avg 平均值、max 最大值、min 最小值、count 计算非空个数。</p><p><strong>特点：</strong></p><ul><li>sum、avg一般用于处理数值型m</li><li>ax、min、count可以处理任何类型</li><li>以上分组函数都忽略null值</li><li>可以和distinct搭配使用</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=k>DISTINCT</span><span class=w> </span><span class=n>salary</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s2>&#34;去重&#34;</span><span class=p>,</span><span class=k>SUM</span><span class=p>(</span><span class=n>salary</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s2>&#34;没去重&#34;</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h4 id=4451-count函数><a href=#4451-count%e5%87%bd%e6%95%b0>#</a>
4.4.5.1 count函数</h4><ol><li>统计行数：count(*)只要有一列不为null就会被统计。</li><li>效率：<ul><li>MYISAM存储引擎下，count(*) 的效率高。</li><li>INNODB存储引擎，count(*)和count(1)的效率差不多，比count(字段)要高一些。</li></ul></li></ol><p><strong>注意：</strong></p><p>​ 和分组函数一同查询的字段要求是group by后的字段</p><h2 id=45-分组查询><a href=#45-%e5%88%86%e7%bb%84%e6%9f%a5%e8%af%a2>#</a>
4.5 分组查询</h2><p><strong>语法：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=err>分组函数</span><span class=p>,</span><span class=err>列（要求出现在</span><span class=k>group</span><span class=w> </span><span class=n>by的后面</span><span class=err>）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=err>表</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>【</span><span class=k>where</span><span class=w> </span><span class=err>筛选条件】</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=err>分组的列表</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>【</span><span class=k>having</span><span class=w> </span><span class=err>筛选条件】</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>【</span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=err>子句】</span><span class=w>
</span></span></span></code></pre></div><p><strong>注意：</strong></p><ul><li>查询列表特殊，要求是分组函数和group by后出现的字段；</li><li>having字句可以让我们筛选分组之后的各种数据；</li><li>分组函数做条件肯定是放在having子句中。</li></ul><h2 id=46-连接查询><a href=#46-%e8%bf%9e%e6%8e%a5%e6%9f%a5%e8%af%a2>#</a>
4.6 连接查询</h2><blockquote><p>SQL92按功能分类</p></blockquote><ol><li><strong>内连接</strong><ul><li>等值连接(n表连接，至少需要n-1个连接条件)。</li><li>非等值连接 。</li><li>自连接。</li></ul></li></ol><blockquote><p>SQL99按功能分类</p></blockquote><p><strong>语法:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=w> </span><span class=k>select</span><span class=w> </span><span class=err>查询列表</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=k>from</span><span class=w> </span><span class=err>表</span><span class=mi>1</span><span class=w> </span><span class=err>别名</span><span class=w> </span><span class=err>【连接类型】</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=k>join</span><span class=w> </span><span class=err>表</span><span class=mi>2</span><span class=w> </span><span class=err>别名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=k>on</span><span class=w> </span><span class=err>连接条件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>【</span><span class=k>where</span><span class=w> </span><span class=err>筛选条件】</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>【</span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=err>分组】</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>【</span><span class=k>having</span><span class=w> </span><span class=err>筛选条件】</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>【</span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=err>排序列表】</span><span class=w>
</span></span></span></code></pre></div><ol><li><strong>内连接（inner)</strong></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>案例：查询员工名、部门名、工种名，并按部门名降序</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>两表以上连接查询有顺序，前面的两张表会形成一个大表，第三张表的连接条件必须在这张大表里面。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=n>last_name</span><span class=p>,</span><span class=n>d</span><span class=p>.</span><span class=n>department_name</span><span class=p>,</span><span class=n>j</span><span class=p>.</span><span class=n>job_title</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w> </span><span class=n>e</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INNER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>departments</span><span class=w> </span><span class=n>d</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=o>`</span><span class=n>department_id</span><span class=o>`</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=o>`</span><span class=n>department_id</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INNER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>jobs</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>j</span><span class=p>.</span><span class=o>`</span><span class=n>job_id</span><span class=o>`</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=o>`</span><span class=n>job_id</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=o>`</span><span class=n>department_name</span><span class=o>`</span><span class=w> </span><span class=k>DESC</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p><strong>连接类型：</strong></p><ul><li><p>等值连接</p></li><li><p>非等值连接</p></li><li><p>自连接</p></li></ul><ol start=2><li><strong>外连接</strong></li></ol><p>应用场景：用于查询一个表中有，另一个表中没有的记录。</p><ul><li>左外连接（left 【outer】）</li><li>右外连接（right【outer】）</li><li>全外连接（full【outer】）</li></ul><ol start=3><li><strong>交叉连接</strong></li></ol><h2 id=47-子查询><a href=#47-%e5%ad%90%e6%9f%a5%e8%af%a2>#</a>
4.7 子查询</h2><h3 id=471-含义><a href=#471-%e5%90%ab%e4%b9%89>#</a>
4.7.1 含义</h3><ul><li><p>出现在其他语句中的select语句，称为子查询或内查询</p></li><li><p>外部的查询语句，称为主查询或外查询。</p></li></ul><h3 id=472-分类><a href=#472-%e5%88%86%e7%b1%bb>#</a>
4.7.2 分类</h3><h4 id=4721-按子查询出现的位置><a href=#4721-%e6%8c%89%e5%ad%90%e6%9f%a5%e8%af%a2%e5%87%ba%e7%8e%b0%e7%9a%84%e4%bd%8d%e7%bd%ae>#</a>
4.7.2.1 按子查询出现的位置</h4><blockquote><p>select后面</p></blockquote><ul><li>仅仅支持标量子查询</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>查询每个部门的员工个数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=o>*</span><span class=p>,(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w> </span><span class=n>e</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>WHERE</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=n>department_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=o>`</span><span class=n>department_id</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=err>个数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>departments</span><span class=w> </span><span class=n>d</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>from后面</p></blockquote><ul><li>支持表子查询</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>案例：查询每个部门的平均工资的工资登记</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>ag_dep</span><span class=p>.</span><span class=o>*</span><span class=p>,</span><span class=n>jg</span><span class=p>.</span><span class=o>`</span><span class=n>grade_level</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=k>AVG</span><span class=p>(</span><span class=n>salary</span><span class=p>)</span><span class=w> </span><span class=n>ag</span><span class=p>,</span><span class=w> </span><span class=n>department_id</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>department_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>)</span><span class=w> </span><span class=n>ag_dep</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INNER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>job_grades</span><span class=w> </span><span class=n>jg</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ON</span><span class=w> </span><span class=n>ag_dep</span><span class=p>.</span><span class=n>ag</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=n>jg</span><span class=p>.</span><span class=o>`</span><span class=n>lowest_sal</span><span class=o>`</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>jg</span><span class=p>.</span><span class=o>`</span><span class=n>highest_sal</span><span class=o>`</span><span class=w> 
</span></span></span></code></pre></div><blockquote><p>where或having后面 ★</p></blockquote><ul><li><p>标量子查询（单行）√（普通的）</p></li><li><p>列子查询（多行）√</p><p><img src=/p/mysql-basic/assets/image-20230721142444630.png width=616 height=337 srcset="/p/mysql-basic/assets/image-20230721142444630_hue1093d5893e162dde8245d56d3262f89_110921_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20230721142444630_hue1093d5893e162dde8245d56d3262f89_110921_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20230721142444630 class=gallery-image data-flex-grow=182 data-flex-basis=438px></p></li><li><p>行子查询</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=p>(</span><span class=n>employee_id</span><span class=p>,</span><span class=n>salary</span><span class=p>)</span><span class=o>=</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>SELECT</span><span class=w> </span><span class=k>MIN</span><span class=p>(</span><span class=n>employee_id</span><span class=p>),</span><span class=k>MAX</span><span class=p>(</span><span class=n>salary</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>局限性</span><span class=w> </span><span class=err>操作符相同（例如：</span><span class=o>=</span><span class=err>）</span><span class=w>
</span></span></span></code></pre></div></li></ul><blockquote><p>exists后面（相关子查询）</p></blockquote><p><strong>注意：根据结果true或false来保留结果集</strong></p><p><strong>语法：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>exists</span><span class=p>(</span><span class=err>完整的查询语句</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p><strong>示例：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>表子查询</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>bo</span><span class=p>.</span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>boys</span><span class=w> </span><span class=n>bo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FROM</span><span class=w> </span><span class=n>beauty</span><span class=w> </span><span class=n>be</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>WHERE</span><span class=w> </span><span class=n>be</span><span class=p>.</span><span class=o>`</span><span class=n>boyfriend_id</span><span class=o>`</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bo</span><span class=p>.</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h4 id=4722-按结果集的行列数不同><a href=#4722-%e6%8c%89%e7%bb%93%e6%9e%9c%e9%9b%86%e7%9a%84%e8%a1%8c%e5%88%97%e6%95%b0%e4%b8%8d%e5%90%8c>#</a>
4.7.2.2 按结果集的行列数不同</h4><ul><li>标量子查询（结果集只有一行一列）。</li><li>列子查询（结果集只有一列多行）。</li><li>行子查询（结果集只有一行多列）。</li><li>表子查询（结果集一般为多行多列）。</li></ul><h2 id=48-分页查询><a href=#48-%e5%88%86%e9%a1%b5%e6%9f%a5%e8%af%a2>#</a>
4.8 分页查询</h2><p><strong>格式：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>limit</span><span class=w> </span><span class=err>【</span><span class=k>offset</span><span class=p>,</span><span class=err>】</span><span class=k>size</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=k>offset</span><span class=w> </span><span class=err>要显示条目的起始索引（起始索引从</span><span class=mi>0</span><span class=err>开始）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=k>size</span><span class=w> </span><span class=err>要显示的条目个数</span><span class=w>
</span></span></span></code></pre></div><p><strong>公式：</strong></p><p>要显示的页数 page，每页的条目数size</p><p><strong>limit (currentPage-1)*pageSize,pageSize;</strong></p><h2 id=49-union联合查询><a href=#49-union%e8%81%94%e5%90%88%e6%9f%a5%e8%af%a2>#</a>
4.9 union联合查询</h2><p>将多条查询语句的结果合并成一个结果</p><p><strong>语法：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=err>查询语句</span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>union</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>查询语句</span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>union</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>...</span><span class=w>
</span></span></span></code></pre></div><p><strong>示例：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>email</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=s1>&#39;%a%&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UNION</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>department_id</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>90</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>**应用场景：**要查询的结果来自于多个表，且多个表没有直接的连接关系，但查询的信息一致时</p><p><strong>特点：</strong></p><ol><li>要求多条查询语句的查询列数是一致的！</li><li>要求多条查询语句的查询的每一列的类型和顺序最好一致。</li><li>union关键字默认去重，如果使用union all 可以包含重复项。</li></ol><h2 id=410-dql的执行顺序><a href=#410-dql%e7%9a%84%e6%89%a7%e8%a1%8c%e9%a1%ba%e5%ba%8f>#</a>
4.10 DQL的执行顺序</h2><ol><li>from</li><li>join</li><li>on</li><li>where</li><li>group by(开始使用select中的别名，后面的语句中都可以使用)</li><li>avg,sum&mldr;.</li><li>having</li><li>select</li><li>distinct</li><li>order by</li><li>limit</li></ol><h1 id=5-数据控制语言dcl><a href=#5-%e6%95%b0%e6%8d%ae%e6%8e%a7%e5%88%b6%e8%af%ad%e8%a8%80dcl>#</a>
5. 数据控制语言DCL</h1><h2 id=51-管理用户><a href=#51-%e7%ae%a1%e7%90%86%e7%94%a8%e6%88%b7>#</a>
5.1 管理用户</h2><h3 id=512-查询用户><a href=#512-%e6%9f%a5%e8%af%a2%e7%94%a8%e6%88%b7>#</a>
5.1.2 查询用户</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>USE</span><span class=w> </span><span class=n>mysql</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>user</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=513-创建用户><a href=#513-%e5%88%9b%e5%bb%ba%e7%94%a8%e6%88%b7>#</a>
5.1.3 创建用户</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>USER</span><span class=w> </span><span class=s1>&#39;用户名&#39;</span><span class=o>@</span><span class=s1>&#39;主机名&#39;</span><span class=w> </span><span class=n>IDENTIFIED</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=s1>&#39;密码&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=514-修改用户密码><a href=#514-%e4%bf%ae%e6%94%b9%e7%94%a8%e6%88%b7%e5%af%86%e7%a0%81>#</a>
5.1.4 修改用户密码</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>USER</span><span class=w> </span><span class=s1>&#39;用户名&#39;</span><span class=o>@</span><span class=s1>&#39;主机名&#39;</span><span class=w> </span><span class=n>IDENTIFIED</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=n>mysql_native_password</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=s1>&#39;新密码&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=515-删除用户><a href=#515-%e5%88%a0%e9%99%a4%e7%94%a8%e6%88%b7>#</a>
5.1.5 删除用户</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>USER</span><span class=w> </span><span class=s1>&#39;用户名&#39;</span><span class=o>@</span><span class=s1>&#39;主机名&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p><strong>完整示例：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 创建用户test，只能在当前主机localhost访问
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>create</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=s1>&#39;test&#39;</span><span class=o>@</span><span class=s1>&#39;localhost&#39;</span><span class=w> </span><span class=n>identified</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=s1>&#39;123456&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 创建用户test，能在任意主机访问
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>create</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=s1>&#39;test&#39;</span><span class=o>@</span><span class=s1>&#39;%&#39;</span><span class=w> </span><span class=n>identified</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=s1>&#39;123456&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=s1>&#39;test&#39;</span><span class=w> </span><span class=n>identified</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=s1>&#39;123456&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 修改密码
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>alter</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=s1>&#39;test&#39;</span><span class=o>@</span><span class=s1>&#39;localhost&#39;</span><span class=w> </span><span class=n>identified</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=n>mysql_native_password</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=s1>&#39;1234&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 删除用户
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>drop</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=s1>&#39;test&#39;</span><span class=o>@</span><span class=s1>&#39;localhost&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=516-注意事项><a href=#516-%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9>#</a>
5.1.6 注意事项</h3><ol><li>主机名可以使用 % 通配</li></ol><h2 id=52-权限控制><a href=#52-%e6%9d%83%e9%99%90%e6%8e%a7%e5%88%b6>#</a>
5.2 权限控制</h2><blockquote><p>常用权限</p></blockquote><div class=table-wrapper><table><thead><tr><th>权限</th><th>说明</th></tr></thead><tbody><tr><td>ALL, ALL PRIVILEGES</td><td>所有权限</td></tr><tr><td>SELECT</td><td>查询数据</td></tr><tr><td>INSERT</td><td>插入数据</td></tr><tr><td>UPDATE</td><td>修改数据</td></tr><tr><td>DELETE</td><td>删除数据</td></tr><tr><td>ALTER</td><td>修改表</td></tr><tr><td>DROP</td><td>删除数据库/表/视图</td></tr><tr><td>CREATE</td><td>创建数据库/表</td></tr></tbody></table></div><h3 id=521-查询权限><a href=#521-%e6%9f%a5%e8%af%a2%e6%9d%83%e9%99%90>#</a>
5.2.1 查询权限</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SHOW</span><span class=w> </span><span class=n>GRANTS</span><span class=w> </span><span class=k>FOR</span><span class=w> </span><span class=s1>&#39;用户名&#39;</span><span class=o>@</span><span class=s1>&#39;主机名&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=522-授予权限><a href=#522-%e6%8e%88%e4%ba%88%e6%9d%83%e9%99%90>#</a>
5.2.2 授予权限</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>GRANT</span><span class=w> </span><span class=err>权限列表</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=err>数据库名</span><span class=p>.</span><span class=err>表名</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=s1>&#39;用户名&#39;</span><span class=o>@</span><span class=s1>&#39;主机名&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=523-撤销权限><a href=#523-%e6%92%a4%e9%94%80%e6%9d%83%e9%99%90>#</a>
5.2.3 撤销权限</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>REVOKE</span><span class=w> </span><span class=err>权限列表</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=err>数据库名</span><span class=p>.</span><span class=err>表名</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=s1>&#39;用户名&#39;</span><span class=o>@</span><span class=s1>&#39;主机名&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=524-刷新权限><a href=#524-%e5%88%b7%e6%96%b0%e6%9d%83%e9%99%90>#</a>
5.2.4 刷新权限</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>使用</span><span class=n>FLUSH命令刷新MySQL的缓存</span><span class=err>，包括授权表缓存：</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>FLUSH</span><span class=w> </span><span class=k>PRIVILEGES</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p><strong>MySQL权限刷新注意事项：</strong></p><ol><li><p>刷新权限需要以root用户登录MySQL数据库。</p></li><li><p>刷新权限可能会影响MySQL的性能，建议在低峰期进行操作。</p></li><li><p>刷新权限后，所有修改的用户权限都会生效，包括新增用户和修改已有用户的权限。</p></li></ol><h3 id=524-注意事项><a href=#524-%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9>#</a>
5.2.4 注意事项</h3><ul><li>多个权限用逗号分隔</li><li>授权时，数据库名和表名可以用 * 进行通配，代表所有</li></ul><h1 id=6-tcl视图控制语言><a href=#6-tcl%e8%a7%86%e5%9b%be%e6%8e%a7%e5%88%b6%e8%af%ad%e8%a8%80>#</a>
6. TCL视图控制语言</h1><h2 id=61-事务的acidacid属性><a href=#61-%e4%ba%8b%e5%8a%a1%e7%9a%84acidacid%e5%b1%9e%e6%80%a7>#</a>
6.1 事务的ACID（acid）属性</h2><ol><li>原子性（Atomicity）：原子性是指事务是一个不可分割的工作单位，事务中的操作要么都发生，要么都不发生。</li><li>一致性（Consistency）：事务必须使数据库从一个一致性状态变换到另外一个一致性状态。</li><li>隔离性（Lsolation） ：事务的隔离性是指一个事务的执行不能被其他事务干扰，即一个事务内部的操作及使用的数据对并发的其他事物是隔离的，并发执行的各个事务之间不能互相干扰。</li><li>持久性（Durability）：持久性是指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来的其他操作和数据库故障不应该对其有任何影响。</li></ol><h2 id=62-事务的创建><a href=#62-%e4%ba%8b%e5%8a%a1%e7%9a%84%e5%88%9b%e5%bb%ba>#</a>
6.2 事务的创建</h2><h3 id=621-隐式事务><a href=#621-%e9%9a%90%e5%bc%8f%e4%ba%8b%e5%8a%a1>#</a>
6.2.1 隐式事务</h3><p>事务没有明显的开启和结束标记比如：insert、update、delete语句</p><h3 id=622-显式事务><a href=#622-%e6%98%be%e5%bc%8f%e4%ba%8b%e5%8a%a1>#</a>
6.2.2 显式事务</h3><p>事务具有明显的开启和结束标记，前提：必须先设置自动提交功能为禁用</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>步骤</span><span class=mi>1</span><span class=err>：开启事务</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>set</span><span class=w> </span><span class=n>autocommit</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>当前会话有效（默认</span><span class=k>start</span><span class=w> </span><span class=k>transaction</span><span class=err>）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>start</span><span class=w> </span><span class=k>transaction</span><span class=p>;</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>可选的</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>步骤</span><span class=mi>2</span><span class=err>：编写事务中的</span><span class=n>sql语句</span><span class=err>（</span><span class=k>select</span><span class=w> </span><span class=k>insert</span><span class=w> </span><span class=k>update</span><span class=w> </span><span class=k>delete</span><span class=err>）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>语句</span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>语句</span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>步骤</span><span class=mi>3</span><span class=err>：结束事务</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>commit</span><span class=p>;</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>提交事务</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>rollback</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=err>回滚事务</span><span class=w>
</span></span></span></code></pre></div><p>回滚点：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>set</span><span class=w> </span><span class=n>autocommit</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>start</span><span class=w> </span><span class=k>transaction</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>语句</span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>savepoint</span><span class=w> </span><span class=err>保存点名</span><span class=p>;</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>设置保存点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>语句</span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>rollback</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=err>保存点名</span><span class=p>;</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>回滚到保存点</span><span class=w>
</span></span></span></code></pre></div><h2 id=63-并发事务><a href=#63-%e5%b9%b6%e5%8f%91%e4%ba%8b%e5%8a%a1>#</a>
6.3 并发事务</h2><div class=table-wrapper><table><thead><tr><th>问题</th><th>描述</th></tr></thead><tbody><tr><td>脏读</td><td>一个事务读到另一个事务还没提交的数据</td></tr><tr><td>不可重复读</td><td>一个事务先后读取同一条记录，但两次读取的数据不同</td></tr><tr><td>幻读</td><td>一个事务按照条件查询数据时，没有对应的数据行，但是再插入数据时，又发现这行数据已经存在</td></tr></tbody></table></div><p>这三个问题的详细演示：https://www.bilibili.com/video/BV1Kr4y1i7ru?p=55cd</p><p><strong>并发事务隔离级别：</strong></p><div class=table-wrapper><table><thead><tr><th>隔离级别</th><th>脏读</th><th>不可重复读</th><th>幻读</th></tr></thead><tbody><tr><td>Read uncommitted</td><td>√</td><td>√</td><td>√</td></tr><tr><td>Read committed</td><td>×</td><td>√</td><td>√</td></tr><tr><td>Repeatable Read(默认)</td><td>×</td><td>×</td><td>√</td></tr><tr><td>Serializable</td><td>×</td><td>×</td><td>×</td></tr></tbody></table></div><ul><li>√表示在当前隔离级别下该问题会出现</li><li>Serializable 性能最低；Read uncommitted 性能最高，数据安全性最差</li></ul><p>查看事务隔离级别：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>@@</span><span class=n>TRANSACTION_ISOLATION</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>设置事务隔离级别：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SET</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=k>SESSION</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>GLOBAL</span><span class=w> </span><span class=p>]</span><span class=w> </span><span class=k>TRANSACTION</span><span class=w> </span><span class=k>ISOLATION</span><span class=w> </span><span class=k>LEVEL</span><span class=w> </span><span class=err>{</span><span class=k>READ</span><span class=w> </span><span class=k>UNCOMMITTED</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>READ</span><span class=w> </span><span class=k>COMMITTED</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>REPEATABLE</span><span class=w> </span><span class=k>READ</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>SERIALIZABLE</span><span class=w> </span><span class=err>}</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>SESSION 是会话级别，表示只针对当前会话有效，GLOBAL 表示对所有会话有效</p><h1 id=7-视图><a href=#7-%e8%a7%86%e5%9b%be>#</a>
7. 视图</h1><h2 id=71-应用场景><a href=#71-%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af>#</a>
7.1 应用场景</h2><ol><li><p>多个地方用到同样的查询结果</p></li><li><p>该查询结果使用的sql语句比较复杂</p></li></ol><h2 id=72-创建视图><a href=#72-%e5%88%9b%e5%bb%ba%e8%a7%86%e5%9b%be>#</a>
7.2 创建视图</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>VIEW</span><span class=w> </span><span class=err>视图名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>查询语句</span><span class=p>...</span><span class=w>
</span></span></span></code></pre></div><h2 id=73-修改视图><a href=#73-%e4%bf%ae%e6%94%b9%e8%a7%86%e5%9b%be>#</a>
7.3 修改视图</h2><blockquote><p>方式一、如果存在则修改，不存在则创建</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=k>REPLACE</span><span class=w> </span><span class=k>VIEW</span><span class=w> </span><span class=err>视图名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>查询语句</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>方式二、</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>VIEW</span><span class=w> </span><span class=err>视图名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>查询语句</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=74-删除视图><a href=#74-%e5%88%a0%e9%99%a4%e8%a7%86%e5%9b%be>#</a>
7.4 删除视图</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>VIEW</span><span class=w> </span><span class=err>视图名</span><span class=mi>1</span><span class=p>,</span><span class=err>视图名</span><span class=mi>2</span><span class=p>....;</span><span class=w>
</span></span></span></code></pre></div><h1 id=8-变量><a href=#8-%e5%8f%98%e9%87%8f>#</a>
8. 变量</h1><h2 id=81-系统变量><a href=#81-%e7%b3%bb%e7%bb%9f%e5%8f%98%e9%87%8f>#</a>
8.1 系统变量</h2><p>变量由系统提供，不是用户定义，属于服务器层面</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=mi>1</span><span class=err>、查看所有的系统变量或者会话变量</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SHOW</span><span class=w> </span><span class=k>GLOBAL</span><span class=o>|</span><span class=k>SESSION</span><span class=w> </span><span class=n>VARIABLES</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=mi>2</span><span class=err>、查看满足条件的部分系统变量</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SHOW</span><span class=w> </span><span class=k>GLOBAL</span><span class=o>|</span><span class=k>SESSION</span><span class=w> </span><span class=n>VARIABLES</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=s1>&#39;%char%&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=mi>3</span><span class=err>、查看指定的某个系统变量的值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>@@</span><span class=k>global</span><span class=o>|</span><span class=k>session</span><span class=p>.</span><span class=err>系统变量名</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=mi>4</span><span class=err>、为某个系统变量赋值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=k>GLOBAL</span><span class=o>|</span><span class=k>SESSION</span><span class=w> </span><span class=err>系统变量名</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=err>值</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=o>@@</span><span class=k>global</span><span class=o>|</span><span class=k>session</span><span class=p>.</span><span class=err>系统变量名</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=err>值</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=82-自定义变量><a href=#82-%e8%87%aa%e5%ae%9a%e4%b9%89%e5%8f%98%e9%87%8f>#</a>
8.2 自定义变量</h2><blockquote><p>用户变量：作用域：针对于当前会话（连接）有效，同于会话变量的作用域</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>①声明并初始化</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SET</span><span class=w> </span><span class=o>@</span><span class=err>用户变量名</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=err>值</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SET</span><span class=w> </span><span class=o>@</span><span class=err>用户变量名</span><span class=w> </span><span class=p>:</span><span class=o>=</span><span class=w> </span><span class=err>值</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=o>@</span><span class=err>用户变量名</span><span class=w> </span><span class=p>:</span><span class=o>=</span><span class=w> </span><span class=err>值</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>②赋值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SET</span><span class=w> </span><span class=o>@</span><span class=err>变量名</span><span class=o>=</span><span class=err>值</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=err>字段</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>@</span><span class=err>变量名</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=err>表</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>③查看</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=o>@</span><span class=err>变量名</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>局部变量</p></blockquote><p>作用域：仅仅在定义它的begin end中有效</p><p>begin end 第一句话</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>①声明</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>DECLARE</span><span class=w> </span><span class=err>变量名</span><span class=w> </span><span class=err>类型</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>DECLARE</span><span class=w> </span><span class=err>变量名</span><span class=w> </span><span class=err>类型</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=err>值</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>②赋值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>方式一</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>SET</span><span class=w> </span><span class=err>局部变量名</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=err>值</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>SET</span><span class=w> </span><span class=err>局部变量名</span><span class=w> </span><span class=p>:</span><span class=o>=</span><span class=w> </span><span class=err>值</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>SELECT</span><span class=w> </span><span class=o>@</span><span class=err>局部变量名</span><span class=w> </span><span class=p>:</span><span class=o>=</span><span class=w> </span><span class=err>值</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>方式二</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>SELECT</span><span class=w> </span><span class=err>字段</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=err>局部变量名</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=err>表</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>③查看</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>SELECT</span><span class=w> </span><span class=err>局部变量名</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h1 id=9-存储过程><a href=#9-%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b>#</a>
9. 存储过程</h1><p>一组预编译好的SQL语句的集合，理解成批处理</p><ol><li>提高代码的重用性</li><li>简化操作</li><li>减少了编译次数并且减少了和数据库服务器的连接次数，提高效率</li></ol><p>**运用场景：**批量的插入、批量的更新</p><h2 id=91-空参列表><a href=#91-%e7%a9%ba%e5%8f%82%e5%88%97%e8%a1%a8>#</a>
9.1 空参列表</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>空参列表</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>DELIMITER</span><span class=w> </span><span class=err>$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>myp1</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  	</span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=k>admin</span><span class=p>(</span><span class=n>username</span><span class=p>,</span><span class=o>`</span><span class=n>password</span><span class=o>`</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  	</span><span class=k>VALUES</span><span class=p>(</span><span class=s1>&#39;join1&#39;</span><span class=p>,</span><span class=s1>&#39;00000&#39;</span><span class=p>),(</span><span class=s1>&#39;lily&#39;</span><span class=p>,</span><span class=s1>&#39;00000&#39;</span><span class=p>),(</span><span class=s1>&#39;rose&#39;</span><span class=p>,</span><span class=s1>&#39;00000&#39;</span><span class=p>),(</span><span class=s1>&#39;jack&#39;</span><span class=p>,</span><span class=s1>&#39;00000&#39;</span><span class=p>),(</span><span class=s1>&#39;tom&#39;</span><span class=p>,</span><span class=s1>&#39;00000&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>END</span><span class=w> </span><span class=err>$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>调用</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>CALL</span><span class=w> </span><span class=n>myp1</span><span class=p>()</span><span class=w>
</span></span></span></code></pre></div><h2 id=92-in模式参数的存储过程><a href=#92-in%e6%a8%a1%e5%bc%8f%e5%8f%82%e6%95%b0%e7%9a%84%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b>#</a>
9.2 in模式参数的存储过程</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>创建带</span><span class=n>in模式参数的存储过程</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>案例：创建存储过程实现根据女神名，查询对应的男神信息</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>DELIMITER</span><span class=w> </span><span class=err>$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>myp1</span><span class=p>(</span><span class=k>IN</span><span class=w> </span><span class=n>beautyname</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    	</span><span class=k>SELECT</span><span class=w> </span><span class=n>bo</span><span class=p>.</span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>beauty</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=k>RIGHT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>boys</span><span class=w> </span><span class=n>bo</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=n>boyfriend_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bo</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    	</span><span class=k>WHERE</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>beautyname</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>END</span><span class=w> </span><span class=err>$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>调用</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>CALL</span><span class=w> </span><span class=n>myp1</span><span class=p>(</span><span class=s1>&#39;小昭&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h2 id=93-out模式参数的存储过程><a href=#93-out%e6%a8%a1%e5%bc%8f%e5%8f%82%e6%95%b0%e7%9a%84%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b>#</a>
9.3 out模式参数的存储过程</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DELIMITER</span><span class=w> </span><span class=err>$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>save3</span><span class=p>(</span><span class=k>IN</span><span class=w> </span><span class=n>beatyName</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span><span class=k>OUT</span><span class=w> </span><span class=n>boyName</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span><span class=k>OUT</span><span class=w> </span><span class=n>userCP</span><span class=w> </span><span class=nb>INT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>SELECT</span><span class=w> </span><span class=n>bo</span><span class=p>.</span><span class=n>boyName</span><span class=p>,</span><span class=n>bo</span><span class=p>.</span><span class=n>userCP</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>boyName</span><span class=p>,</span><span class=n>userCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FROM</span><span class=w> </span><span class=n>beauty</span><span class=w> </span><span class=n>be</span><span class=w> </span><span class=k>INNER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>boys</span><span class=w> </span><span class=n>bo</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>be</span><span class=p>.</span><span class=n>boyfriend_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bo</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>WHERE</span><span class=w> </span><span class=n>be</span><span class=p>.</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>beatyName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w> </span><span class=err>$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>调用</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CALL</span><span class=w> </span><span class=n>save3</span><span class=p>(</span><span class=s1>&#39;小昭&#39;</span><span class=p>,</span><span class=o>@</span><span class=n>bName</span><span class=p>,</span><span class=o>@</span><span class=n>userC</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>@</span><span class=n>bName</span><span class=p>,</span><span class=o>@</span><span class=n>userC</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=94-inout模式参数的存储过程><a href=#94-inout%e6%a8%a1%e5%bc%8f%e5%8f%82%e6%95%b0%e7%9a%84%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b>#</a>
9.4 inout模式参数的存储过程</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DELIMITER</span><span class=w> </span><span class=err>$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>save3</span><span class=p>(</span><span class=k>INOUT</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=nb>INT</span><span class=p>,</span><span class=k>INOUT</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=nb>INT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>SET</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=p>:</span><span class=o>=</span><span class=w> </span><span class=n>a</span><span class=o>*</span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>SET</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=p>:</span><span class=o>=</span><span class=w> </span><span class=n>b</span><span class=o>*</span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w> </span><span class=err>$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>调用</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=o>@</span><span class=n>a</span><span class=w> </span><span class=p>:</span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=o>@</span><span class=n>b</span><span class=w> </span><span class=p>:</span><span class=o>=</span><span class=w> </span><span class=mi>20</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CALL</span><span class=w> </span><span class=n>save3</span><span class=p>(</span><span class=o>@</span><span class=n>a</span><span class=p>,</span><span class=o>@</span><span class=n>b</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>@</span><span class=n>a</span><span class=p>,</span><span class=o>@</span><span class=n>b</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=95-删除存储过程><a href=#95-%e5%88%a0%e9%99%a4%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b>#</a>
9.5 删除存储过程</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=err>存储过程名称</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=96-查看存储过程结构><a href=#96-%e6%9f%a5%e7%9c%8b%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b%e7%bb%93%e6%9e%84>#</a>
9.6 查看存储过程结构</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SHOW</span><span class=w> </span><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=err>存储过程名称</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h1 id=10-函数><a href=#10-%e5%87%bd%e6%95%b0>#</a>
10. 函数</h1><p>有且仅有一个返回</p><p><strong>运用场景：适合做处理数据后返回一个结果</strong></p><h2 id=101-创建函数><a href=#101-%e5%88%9b%e5%bb%ba%e5%87%bd%e6%95%b0>#</a>
10.1 创建函数</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>创建语法</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DELIMITER</span><span class=w> </span><span class=err>$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>FUNCTION</span><span class=w> </span><span class=err>函数名</span><span class=p>(</span><span class=err>参数列表</span><span class=p>)</span><span class=w> </span><span class=k>RETURNS</span><span class=w> </span><span class=err>返回类型</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>函数体</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w> </span><span class=err>$</span><span class=w>
</span></span></span></code></pre></div><p><strong>案例说明：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=err>案例：根据部门名，返回该部门的平均工资</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DELIMITER</span><span class=w> </span><span class=err>$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>FUNCTION</span><span class=w> </span><span class=n>myf1</span><span class=p>(</span><span class=n>depName</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>))</span><span class=w> </span><span class=k>RETURNS</span><span class=w> </span><span class=n>DOUBLE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>DECLARE</span><span class=w> </span><span class=k>result</span><span class=w> </span><span class=n>DOUBLE</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>SELECT</span><span class=w> </span><span class=k>AVG</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=n>salary</span><span class=p>)</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=k>result</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w> </span><span class=n>e</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>INNER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>departments</span><span class=w> </span><span class=n>d</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=n>department_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=n>department_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>WHERE</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=n>department_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>depName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>RETURN</span><span class=w> </span><span class=k>result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w> </span><span class=err>$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>调用</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>myf1</span><span class=p>(</span><span class=s1>&#39;IT&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h2 id=102-查看函数><a href=#102-%e6%9f%a5%e7%9c%8b%e5%87%bd%e6%95%b0>#</a>
10.2 查看函数</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SHOW</span><span class=w> </span><span class=k>CREATE</span><span class=w> </span><span class=k>FUNCTION</span><span class=w> </span><span class=err>函数名称</span><span class=w>
</span></span></span></code></pre></div><h2 id=103-删除函数><a href=#103-%e5%88%a0%e9%99%a4%e5%87%bd%e6%95%b0>#</a>
10.3 删除函数</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>FUNCTION</span><span class=w> </span><span class=err>函数名</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h1 id=11-流程控制语句><a href=#11-%e6%b5%81%e7%a8%8b%e6%8e%a7%e5%88%b6%e8%af%ad%e5%8f%a5>#</a>
11. 流程控制语句</h1><h2 id=111-分支结构><a href=#111-%e5%88%86%e6%94%af%e7%bb%93%e6%9e%84>#</a>
11.1 分支结构</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>语法：</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>IF</span><span class=w> </span><span class=err>条件</span><span class=mi>1</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=err>语句</span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>ELSEIF</span><span class=w> </span><span class=err>条件</span><span class=mi>2</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=err>语句</span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=err>【</span><span class=k>else</span><span class=w> </span><span class=err>语句</span><span class=n>n</span><span class=p>;</span><span class=err>】</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>END</span><span class=w> </span><span class=k>IF</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>应用在</span><span class=w> </span><span class=k>begin</span><span class=w> </span><span class=n>end中</span><span class=w>
</span></span></span></code></pre></div><h2 id=112-循环结构><a href=#112-%e5%be%aa%e7%8e%af%e7%bb%93%e6%9e%84>#</a>
11.2 循环结构</h2><p><strong>循环控制：</strong></p><ul><li><p>iterate 类似于continue</p></li><li><p>leave 类似于 break</p></li></ul><blockquote><p>while 循环结构</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>语法</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>【标签</span><span class=p>:</span><span class=err>】</span><span class=w> </span><span class=n>WHILE</span><span class=w> </span><span class=err>循环条件</span><span class=w> </span><span class=k>DO</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=err>循环体</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w> </span><span class=n>WHILE</span><span class=w> </span><span class=err>【标签】</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>loop 循环结构</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=err>【标签</span><span class=p>:</span><span class=err>】</span><span class=w> </span><span class=n>LOOP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=err>循环体</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w> </span><span class=n>LOOP</span><span class=w> </span><span class=err>【标签】</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>可以用来模拟简单的死循环</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>repeat 循环结构</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=err>【标签</span><span class=p>:</span><span class=err>】</span><span class=w> </span><span class=n>REPEAT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=err>循环体</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UNTIL</span><span class=w> </span><span class=err>结束循环的条件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w> </span><span class=n>REPEAT</span><span class=w> </span><span class=err>【标签】</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>类似于</span><span class=w> </span><span class=k>do</span><span class=w> </span><span class=n>while</span><span class=w> </span><span class=err>，至少执行一次</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h1 id=12-存储引擎><a href=#12-%e5%ad%98%e5%82%a8%e5%bc%95%e6%93%8e>#</a>
12. 存储引擎</h1><p>​ 存储引擎就是存储数据、建立索引、更新/查询数据等技术的实现方式。存储引擎是基于表的，而不是库的，所以存储引擎也可以被称为表类型。</p><h2 id=121-基本操作><a href=#121-%e5%9f%ba%e6%9c%ac%e6%93%8d%e4%bd%9c>#</a>
12.1 基本操作</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>my_innodb</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>id</span><span class=w> </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=n>ENGINE</span><span class=w> </span><span class=n>INNODB</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=122-innodb存储引擎><a href=#122-innodb%e5%ad%98%e5%82%a8%e5%bc%95%e6%93%8e>#</a>
12.2 InnoDB存储引擎</h2><h3 id=1221-介绍><a href=#1221-%e4%bb%8b%e7%bb%8d>#</a>
12.2.1 介绍</h3><p>​ InnoDB是一种兼顾高可靠性和高性能的通用存储引擎，在MySQL5.5之后，InnoDB是默认的MySQL存储引擎。</p><h3 id=1222-特点><a href=#1222-%e7%89%b9%e7%82%b9>#</a>
12.2.2 特点</h3><ol><li><p>DML操作遵循ACID模型，支持事务；</p></li><li><p>行级锁，提高高并发访问性能；</p></li><li><p>支持外键约束FOREIGN KEY 约束，保持数据的完整性和正确性；</p></li></ol><h3 id=1223-文件><a href=#1223-%e6%96%87%e4%bb%b6>#</a>
12.2.3 文件</h3><p>xxx.ibd：xxx代表的是表名，innoDB引擎的每一张表都会对应这样的一个表空间文件，存储该表结构（frm、sdi）、数据和索引。</p><p>配置文件参数：innodb_file_per_table</p><h3 id=1224-逻辑存储结构><a href=#1224-%e9%80%bb%e8%be%91%e5%ad%98%e5%82%a8%e7%bb%93%e6%9e%84>#</a>
12.2.4 逻辑存储结构</h3><p><img src=/p/mysql-basic/assets/image-20231101102620891.png width=1322 height=583 srcset="/p/mysql-basic/assets/image-20231101102620891_hub7b5824d001cf6440db82df2b11857d4_319357_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231101102620891_hub7b5824d001cf6440db82df2b11857d4_319357_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231101102620891 class=gallery-image data-flex-grow=226 data-flex-basis=544px></p><h1 id=13-索引><a href=#13-%e7%b4%a2%e5%bc%95>#</a>
13. 索引</h1><h2 id=131-索引的概述><a href=#131-%e7%b4%a2%e5%bc%95%e7%9a%84%e6%a6%82%e8%bf%b0>#</a>
13.1 索引的概述</h2><h3 id=1311-介绍><a href=#1311-%e4%bb%8b%e7%bb%8d>#</a>
13.1.1 介绍</h3><p>​ 索引（index）是帮助MySQL高效获取数据的数据结构（有序）。在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。</p><h3 id=1312-优缺点><a href=#1312-%e4%bc%98%e7%bc%ba%e7%82%b9>#</a>
13.1.2 优缺点</h3><div class=table-wrapper><table><thead><tr><th style=text-align:center>优势</th><th style=text-align:center>劣势</th></tr></thead><tbody><tr><td style=text-align:center>提高数据检索的效率，降低数据库的IO成本</td><td style=text-align:center>索引列也是要占用磁盘空间的</td></tr><tr><td style=text-align:center>通过索引列对数据进行排序，降低数据排序的成本，降低CPU的消耗。</td><td style=text-align:center>索引大大提高了查询效率，同时却也降低更新表的速度，如对表进行INSERT、UPDATE、DELETE时，效率降低。</td></tr></tbody></table></div><h2 id=132-索引的结构><a href=#132-%e7%b4%a2%e5%bc%95%e7%9a%84%e7%bb%93%e6%9e%84>#</a>
13.2 索引的结构</h2><p>数据结构动画：https://www.cs.usfca.edu/~galles/visualization/Algorithms.html</p><p>MySQL的索引是在存储引擎层实现的，不同的存储引擎有不同的结构，主要包含以下几种：</p><div class=table-wrapper><table><thead><tr><th>索引结构</th><th>描述</th></tr></thead><tbody><tr><td>B+Tree索引</td><td>最常见的索引类型，大部分引擎都支持B+树索引</td></tr><tr><td>Hash索引</td><td>底层数据结构是用哈希表实现的，只有精确匹配索引列的查询才有效，不支持范围查询</td></tr><tr><td>R-Tree（空间索引）</td><td>空间索引是MyISAM引擎的特殊索引类型，主要用于地理空间数据类型，通常使用较少</td></tr><tr><td>Full-text（全文索引）</td><td>是一种通过建立倒排索引，快速匹配文档的方式。类似于Lucene，Solr，Elasticsearch</td></tr></tbody></table></div><p><img src=/p/mysql-basic/assets/image-20231101105504776.png width=1280 height=355 srcset="/p/mysql-basic/assets/image-20231101105504776_hu9ff475066d0bf51f07373309d2f59858_99488_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231101105504776_hu9ff475066d0bf51f07373309d2f59858_99488_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231101105504776 class=gallery-image data-flex-grow=360 data-flex-basis=865px></p><h3 id=1321-二叉树><a href=#1321-%e4%ba%8c%e5%8f%89%e6%a0%91>#</a>
13.2.1 二叉树</h3><h3 id=1322-btree><a href=#1322-btree>#</a>
13.2.2 Btree</h3><h3 id=1323-btree><a href=#1323-btree>#</a>
13.2.3 B+Tree</h3><h3 id=1324-面试题><a href=#1324-%e9%9d%a2%e8%af%95%e9%a2%98>#</a>
13.2.4 面试题</h3><blockquote><p>问：为什么InnoDB存储引擎选择使用B+tree索引结构</p></blockquote><ol><li>相对于二叉树，层级更少，搜索效率高；</li><li>对于B-Tree，无论是叶子节点，都会保存数据，这样导致一页中存储的键值减少，指针跟着减少，要同样保存大量数据，只能增加树的高度，导致性能降低；</li><li>相对于Hash索引，B+tree支持范围匹配及排序操作；</li></ol><h2 id=133-索引的分类><a href=#133-%e7%b4%a2%e5%bc%95%e7%9a%84%e5%88%86%e7%b1%bb>#</a>
13.3 索引的分类</h2><div class=table-wrapper><table><thead><tr><th>分类</th><th>含义</th><th>特点</th><th>关键字</th></tr></thead><tbody><tr><td>主键索引</td><td>针对于表中主键创建的索引</td><td>默认自动创建，只能有一个</td><td>PRIMARY</td></tr><tr><td>唯一索引</td><td>避免同一个表中某数据列中的值重复</td><td>可以有多个</td><td>UNIQUE</td></tr><tr><td>常规索引</td><td>快速定位特定数据</td><td>可以有多个</td><td></td></tr><tr><td>全文索引</td><td>全文索引查找的是文本中的关键词，而不是比较索引中的值</td><td>可以有多个</td><td>FULLTEXT</td></tr></tbody></table></div><blockquote><p>在InnoDB存储引擎中，根据索引的存储形式，又可以分为以下两种：</p></blockquote><div class=table-wrapper><table><thead><tr><th>分类</th><th>含义</th><th>特点</th></tr></thead><tbody><tr><td>聚集索引（Clustered Index）</td><td>将数据存储与索引放到一块，索引结构的叶子节点保存了行数据</td><td>必须有，而且只有一个</td></tr><tr><td>二级索引（Secondary Index）</td><td>将数据与索引分开存储，索引结构的叶子节点关联的是对应的主键</td><td>可以存在多个</td></tr></tbody></table></div><p>聚集索引选取规：</p><ul><li>如果存在主键，主键索引就是聚集索引。</li><li>如果不存在主键，将使用第一个唯一（UNIQUE）索引作为聚集索引。</li><li>如果表没有主键，或没有合适的唯一索引，则InnoDB会自动生成一个rowid作为隐藏的聚集索引。</li></ul><p><img src=/p/mysql-basic/assets/image-20231101150338377.png width=1293 height=655 srcset="/p/mysql-basic/assets/image-20231101150338377_hu3f5a00e1f881d141b4a905ad6eff7557_370346_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231101150338377_hu3f5a00e1f881d141b4a905ad6eff7557_370346_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231101150338377 class=gallery-image data-flex-grow=197 data-flex-basis=473px></p><blockquote><p>回表查询</p></blockquote><p><img src=/p/mysql-basic/assets/image-20231101173439091.png width=1609 height=840 srcset="/p/mysql-basic/assets/image-20231101173439091_hu4aa70cf398317a5b630b81c9bf021a8c_425148_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231101173439091_hu4aa70cf398317a5b630b81c9bf021a8c_425148_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231101173439091 class=gallery-image data-flex-grow=191 data-flex-basis=459px></p><h2 id=134-索引的语法><a href=#134-%e7%b4%a2%e5%bc%95%e7%9a%84%e8%af%ad%e6%b3%95>#</a>
13.4 索引的语法</h2><h3 id=1341-创建索引><a href=#1341-%e5%88%9b%e5%bb%ba%e7%b4%a2%e5%bc%95>#</a>
13.4.1 创建索引</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=mi>1</span><span class=p>.</span><span class=w> </span><span class=mi>1</span><span class=err>个索引关联一个字段称为：单列索引</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>2</span><span class=p>.</span><span class=w> </span><span class=mi>1</span><span class=err>个索引关联多个字段称为：联合（组合）索引</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>3</span><span class=p>.</span><span class=w> </span><span class=err>索引类型不指定就是普通</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=p>[</span><span class=k>UNIQUE</span><span class=o>|</span><span class=n>FULLTEXT</span><span class=p>]</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>index_name</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=p>(</span><span class=n>column1</span><span class=w> </span><span class=p>[</span><span class=k>ASC</span><span class=o>|</span><span class=k>DESC</span><span class=p>],</span><span class=w> </span><span class=n>column2</span><span class=w> </span><span class=p>[</span><span class=k>ASC</span><span class=o>|</span><span class=k>DESC</span><span class=p>],</span><span class=w> </span><span class=p>...);</span><span class=w>
</span></span></span></code></pre></div><h3 id=1342-查看索引><a href=#1342-%e6%9f%a5%e7%9c%8b%e7%b4%a2%e5%bc%95>#</a>
13.4.2 查看索引</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SHOW</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table_name</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=1343-删除索引><a href=#1343-%e5%88%a0%e9%99%a4%e7%b4%a2%e5%bc%95>#</a>
13.4.3 删除索引</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>index_name</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>table_name</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=135-sql性能分析><a href=#135-sql%e6%80%a7%e8%83%bd%e5%88%86%e6%9e%90>#</a>
13.5 SQL性能分析</h2><h3 id=1351-sql-执行频率><a href=#1351-sql-%e6%89%a7%e8%a1%8c%e9%a2%91%e7%8e%87>#</a>
13.5.1 SQL 执行频率</h3><p>​ MySQL 客户端连接成功后，通过<code>SHOW [SESSION|GLOBAL] status</code>命令可以提供服务器状态信息。通过如下指令，可以查看当前数据库的INSERT、UPDATE、DELETE、SELECT的访问频次：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SHOW</span><span class=w> </span><span class=k>GLOBAL</span><span class=w> </span><span class=n>STATUS</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=s1>&#39;COM_______&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=1352-慢查询日志><a href=#1352-%e6%85%a2%e6%9f%a5%e8%af%a2%e6%97%a5%e5%bf%97>#</a>
13.5.2 慢查询日志</h3><p>慢查询日志记录了所有执行时间超过指定参数（long_query_time，单位：秒，默认10秒）的所有SQL语句的日志。</p><p>MySQL的慢查询日志默认没有开启，需要在MySQL的配置文件（/etc/my.cnf)中配置如下信息：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>开启</span><span class=n>MySQL慢日志查询开关</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>slow_query_long</span><span class=o>=</span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>设置慢日志的时间为</span><span class=mi>2</span><span class=err>秒，</span><span class=n>SQL语句执行时间超过2秒</span><span class=err>，就会视为慢查询，记录慢查询日志</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>long_query_time</span><span class=o>=</span><span class=mi>2</span><span class=w>
</span></span></span></code></pre></div><p>配置完毕之后，通过以下指重新启动MySQL服务器进行测试，查看慢日志文件中记录的信息<code>/var/lib/mysql/localhost-slow.log</code></p><h3 id=1353-profile详情><a href=#1353-profile%e8%af%a6%e6%83%85>#</a>
13.5.3 profile详情</h3><p><code>SHOW profiles</code>能够在做SQL优化时帮助我们了解时间都耗费到哪里去了。通过have_profiling参数，能够看到当前MySQL是否支持profile操作：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>@@</span><span class=n>have_profiling</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>默认是关闭的，可以通过set语句在SESSION/GLOBAL级别开启profiling：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=mi>1</span><span class=p>.</span><span class=w> </span><span class=err>查看</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>@@</span><span class=n>profiling</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>2</span><span class=p>.</span><span class=w> </span><span class=err>设置</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=n>profiling</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>执行一系列的业务SQL的操作，然后通过如下指令查看指令的执行耗时：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>查看每一条</span><span class=n>SQL的耗时基本情况</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SHOW</span><span class=w> </span><span class=n>profiles</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>查看指定</span><span class=n>query_id的SQL语句各个阶段的耗时情况</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SHOW</span><span class=w> </span><span class=n>profile</span><span class=w> </span><span class=k>FOR</span><span class=w> </span><span class=n>QUERY</span><span class=w> </span><span class=n>query_id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>查看指定</span><span class=n>query_id的SQL语句CPU的使用情况</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SHOW</span><span class=w> </span><span class=n>profile</span><span class=w> </span><span class=n>CPU</span><span class=w> </span><span class=k>FOR</span><span class=w> </span><span class=n>QUERY</span><span class=w> </span><span class=n>query_id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=1354-explain执行计划><a href=#1354-explain%e6%89%a7%e8%a1%8c%e8%ae%a1%e5%88%92>#</a>
13.5.4 explain执行计划</h3><p>EXPLAIN或者DESC命令获取MySQL如何执行SELECT语句的信息，包括在SELECT语句执行过程中表如何连接和连接的顺序。</p><p>语法：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>直接再</span><span class=n>SELECT语句之前加上关键字EXPLAIN</span><span class=o>/</span><span class=k>DESC</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=err>字段列表</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=err>表名</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=err>条件</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p><img src=/p/mysql-basic/assets/image-20231106151333315.png width=1554 height=222 srcset="/p/mysql-basic/assets/image-20231106151333315_hu3c8547d909e6f8250660a42d69782dbe_429820_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231106151333315_hu3c8547d909e6f8250660a42d69782dbe_429820_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231106151333315 class=gallery-image data-flex-grow=700 data-flex-basis=1680px></p><p>EXPLAIN 执行计划各字段含义：</p><ul><li><p>id</p><p>select查询的序列号，表示查询中执行select子句或者操作表的顺序（id相同，执行顺序从上到下；id不同，值越大，越先执行）。</p></li><li><p>select_type</p><p>表示SELECT的类型，常见的取值有SIMPLE（简单表，即不使用表连接或者子查询）、PRIMARY（主查询，即外层的查询）、UNION（UNION中的第二个或者后面的查询语句）、SUBQUERY（SELECT/WHERE之后包含了子查询）等。</p></li><li><p><code>type</code></p><p>表示连接类型，性能由好到差的连接类型为NULL、system、const、eq_ref、ref、range、index、all。</p></li><li><p><code>possible_key</code></p><p>显示可能应用在这张表上的索引，一个或多个。</p></li><li><p><code>Key</code></p><p>实际使用的索引，如果为NULL，则没有使用索引。</p></li><li><p><code>Key_len</code></p><p>表示索引中使用的字节数，该值为索引字段最大可能长度，并非实际使用长度，在不损失精确性的前提下，长度越短越好。</p></li><li><p>rows</p><p>MySQL认为必须要执行查询的行数，在InnoDB引擎的表中，是一个估计值，可能并不总是准确的。</p></li><li><p>filtered</p><p>表示返回结果的行数占需读取行数的百分比，filtered的值越大越好。</p></li></ul><h2 id=136-索引的使用><a href=#136-%e7%b4%a2%e5%bc%95%e7%9a%84%e4%bd%bf%e7%94%a8>#</a>
13.6 索引的使用</h2><h3 id=1361-联合索引-最左前缀法则><a href=#1361-%e8%81%94%e5%90%88%e7%b4%a2%e5%bc%95-%e6%9c%80%e5%b7%a6%e5%89%8d%e7%bc%80%e6%b3%95%e5%88%99>#</a>
13.6.1 联合索引-最左前缀法则</h3><p>​ 如果索引了多列（联合索引），要遵循最左前缀法则。最左前缀法则。最左前缀法则指的是查询是从索引的最左列开始，并且不跳过索引中的列。</p><p>​ 如果跳跃某一列，<code>索引将部分失效（后面的字段索引失效）</code></p><p><img src=/p/mysql-basic/assets/image-20231106163431283.png width=1567 height=504 srcset="/p/mysql-basic/assets/image-20231106163431283_hu962d05062d20f2a18a033e657fc9047e_597833_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231106163431283_hu962d05062d20f2a18a033e657fc9047e_597833_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231106163431283 class=gallery-image data-flex-grow=310 data-flex-basis=746px></p><p><img src=/p/mysql-basic/assets/image-20231106164227421.png width=1580 height=518 srcset="/p/mysql-basic/assets/image-20231106164227421_hu9d0743557a09e7e348173e2f80cf3257_665661_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231106164227421_hu9d0743557a09e7e348173e2f80cf3257_665661_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231106164227421 class=gallery-image data-flex-grow=305 data-flex-basis=732px></p><p><img src=/p/mysql-basic/assets/image-20231106163737958.png width=1483 height=579 srcset="/p/mysql-basic/assets/image-20231106163737958_hua85ba1289136cdca588c0f486d2f9fd6_833593_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231106163737958_hua85ba1289136cdca588c0f486d2f9fd6_833593_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231106163737958 class=gallery-image data-flex-grow=256 data-flex-basis=614px></p><p><img src=/p/mysql-basic/assets/image-20231106164056957.png width=1567 height=277 srcset="/p/mysql-basic/assets/image-20231106164056957_hu99727c04f116389fa7c69bd988e6e840_351335_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231106164056957_hu99727c04f116389fa7c69bd988e6e840_351335_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231106164056957 class=gallery-image data-flex-grow=565 data-flex-basis=1357px></p><h3 id=1362-索引失效><a href=#1362-%e7%b4%a2%e5%bc%95%e5%a4%b1%e6%95%88>#</a>
13.6.2 索引失效</h3><h4 id=13621-范围查询><a href=#13621-%e8%8c%83%e5%9b%b4%e6%9f%a5%e8%af%a2>#</a>
13.6.2.1 范围查询</h4><p>联合索引中，出现范围查询（>,&lt;），<code>范围查询右侧的列索引失效</code>。可以用>=或者&lt;=来规避索引失效问题。</p><p><img src=/p/mysql-basic/assets/image-20231106165720678.png width=1531 height=432 srcset="/p/mysql-basic/assets/image-20231106165720678_hu00b77a05f4e5412da5af646a7365d43d_654150_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231106165720678_hu00b77a05f4e5412da5af646a7365d43d_654150_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231106165720678 class=gallery-image data-flex-grow=354 data-flex-basis=850px></p><h4 id=13622-索引列运算><a href=#13622-%e7%b4%a2%e5%bc%95%e5%88%97%e8%bf%90%e7%ae%97>#</a>
13.6.2.2 索引列运算</h4><p>不要在索引列上进行运算操作，<code>索引将失效</code></p><p><img src=/p/mysql-basic/assets/image-20231106170313466.png width=1332 height=205 srcset="/p/mysql-basic/assets/image-20231106170313466_hu37ea04af65e1dbc42e25d9c9530b1dc2_289082_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231106170313466_hu37ea04af65e1dbc42e25d9c9530b1dc2_289082_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231106170313466 class=gallery-image data-flex-grow=649 data-flex-basis=1559px></p><h4 id=13623-字符串不加引号><a href=#13623-%e5%ad%97%e7%ac%a6%e4%b8%b2%e4%b8%8d%e5%8a%a0%e5%bc%95%e5%8f%b7>#</a>
13.6.2.3 字符串不加引号</h4><p>字符串类型字段使用时，不加引号，<code>索引将失效</code>。（隐式转换问题）</p><p><img src=/p/mysql-basic/assets/image-20231106170528173.png width=1276 height=183 srcset="/p/mysql-basic/assets/image-20231106170528173_hu5ba657f04dbd6c6ec28d4c8882fa76b4_260584_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231106170528173_hu5ba657f04dbd6c6ec28d4c8882fa76b4_260584_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231106170528173 class=gallery-image data-flex-grow=697 data-flex-basis=1673px></p><h4 id=13624-模糊查询><a href=#13624-%e6%a8%a1%e7%b3%8a%e6%9f%a5%e8%af%a2>#</a>
13.6.2.4 模糊查询</h4><p>如果仅仅是尾部模糊匹配，索引不会失效。如果是头部模糊匹配，索引失效。</p><p><img src=/p/mysql-basic/assets/image-20231106171309798.png width=1511 height=610 srcset="/p/mysql-basic/assets/image-20231106171309798_hua3ad5057786f938803b8cb4449bd7a6b_877278_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231106171309798_hua3ad5057786f938803b8cb4449bd7a6b_877278_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231106171309798 class=gallery-image data-flex-grow=247 data-flex-basis=594px></p><h4 id=13625-or连接的条件><a href=#13625-or%e8%bf%9e%e6%8e%a5%e7%9a%84%e6%9d%a1%e4%bb%b6>#</a>
13.6.2.5 OR连接的条件</h4><p>用or分割开的条件，如果or前的条件中的列有索引，而后面的列中没有索引，那么涉及的索引都不会被用到。两边都有索引才会走索引（全真为真）。</p><p><img src=/p/mysql-basic/assets/image-20231106172016590.png width=1275 height=141 srcset="/p/mysql-basic/assets/image-20231106172016590_hudd0c79867be5f00a7378eec0e59502e2_231484_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231106172016590_hudd0c79867be5f00a7378eec0e59502e2_231484_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231106172016590 class=gallery-image data-flex-grow=904 data-flex-basis=2170px></p><p>需要对age单独建立索引</p><h4 id=13626-数据分布影响><a href=#13626-%e6%95%b0%e6%8d%ae%e5%88%86%e5%b8%83%e5%bd%b1%e5%93%8d>#</a>
13.6.2.6 数据分布影响</h4><p>如果MySQL评估使用索引比全表更慢，则不使用索引。</p><p><img src=/p/mysql-basic/assets/image-20231106172640528.png width=1248 height=619 srcset="/p/mysql-basic/assets/image-20231106172640528_hu335aac1773f7f720cf3fddf544ff87ac_1143641_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231106172640528_hu335aac1773f7f720cf3fddf544ff87ac_1143641_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231106172640528 class=gallery-image data-flex-grow=201 data-flex-basis=483px></p><p><img src=/p/mysql-basic/assets/image-20231106172717294.png width=1445 height=669 srcset="/p/mysql-basic/assets/image-20231106172717294_hudd6dd83da6bb26190dd204a2ee8cd08b_855918_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231106172717294_hudd6dd83da6bb26190dd204a2ee8cd08b_855918_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231106172717294 class=gallery-image data-flex-grow=215 data-flex-basis=518px></p><p><img src=/p/mysql-basic/assets/image-20231106172955403.png width=1485 height=698 srcset="/p/mysql-basic/assets/image-20231106172955403_huae5071b1dff0d08b8347675091949a68_974300_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231106172955403_huae5071b1dff0d08b8347675091949a68_974300_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231106172955403 class=gallery-image data-flex-grow=212 data-flex-basis=510px></p><p>mysq优化器会自动选择最优</p><h3 id=1363-sql提示><a href=#1363-sql%e6%8f%90%e7%a4%ba>#</a>
13.6.3 SQL提示</h3><p>SQL提示，是优化数据库的一个重要手段，简单来说，就是在SQL语句中加入一些人为的提示来达到优化操作的目的。</p><ul><li>use index：建议使用索引</li><li>ignore index：忽略该索引</li><li>force index：强制使用该索引</li></ul><p><img src=/p/mysql-basic/assets/image-20231106173551420.png width=917 height=374 srcset="/p/mysql-basic/assets/image-20231106173551420_hua0ba3584707b9497de0ab2a3f1dce184_157802_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231106173551420_hua0ba3584707b9497de0ab2a3f1dce184_157802_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231106173551420 class=gallery-image data-flex-grow=245 data-flex-basis=588px></p><h3 id=1364-覆盖索引><a href=#1364-%e8%a6%86%e7%9b%96%e7%b4%a2%e5%bc%95>#</a>
13.6.4 覆盖索引</h3><p>​ 覆盖索引（covering index ，或称为索引覆盖）即从非主键索引中就能查到的记录，而不需要去查询主键索引中的记录，避免了回表的产生，减少了树的搜索次数，显著提升性能。</p><p>尽量使用覆盖索引（查询使用了索引，并且需要返回的列，在该索引中已经全部能够找到），减少SELECT *。</p><p><img src=/p/mysql-basic/assets/image-20231107152326117.png width=1272 height=469 srcset="/p/mysql-basic/assets/image-20231107152326117_huf4da06bcb07c7adff20a04eab87c6fe0_323244_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231107152326117_huf4da06bcb07c7adff20a04eab87c6fe0_323244_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231107152326117 class=gallery-image data-flex-grow=271 data-flex-basis=650px></p><p><img src=/p/mysql-basic/assets/image-20231107152818393.png width=1583 height=623 srcset="/p/mysql-basic/assets/image-20231107152818393_hudb0da59af5e86d6bcf14b0cad15763a6_847943_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231107152818393_hudb0da59af5e86d6bcf14b0cad15763a6_847943_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231107152818393 class=gallery-image data-flex-grow=254 data-flex-basis=609px></p><h3 id=1365-前缀索引><a href=#1365-%e5%89%8d%e7%bc%80%e7%b4%a2%e5%bc%95>#</a>
13.6.5 前缀索引</h3><p>当字段类型为字符串（varchar，text等）时，有时候需要索引很长的字符串，这会让索引变得很大，查询时，浪费大量的磁盘IO，影响查询效率。此时可以只将字符串的一部分前缀，建立索引，这样可以节约索引空间，从而提高索引效率。</p><blockquote><p>语法</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=n>n取前几个字符</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_xxx</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>table_name</span><span class=p>(</span><span class=k>column</span><span class=p>(</span><span class=n>n</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>前缀长度</p></blockquote><p>可以根据索引的选择性来决定，而选择性是指不重复的索引值（基数）和数据表的记录总数的比值，索引选择性越高则查询效率越高，唯一索引的选择性是1，这是最好的索引选择性，性能也是最好的。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=k>DISTINCT</span><span class=w> </span><span class=n>email</span><span class=p>)</span><span class=o>/</span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>tb_user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=k>DISTINCT</span><span class=w> </span><span class=k>SUBSTRING</span><span class=p>(</span><span class=n>email</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>5</span><span class=p>))</span><span class=o>/</span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>tb_user</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p><img src=/p/mysql-basic/assets/image-20231107154421759.png width=1348 height=664 srcset="/p/mysql-basic/assets/image-20231107154421759_huf67e680e4fafdd6f4f8ee437dcadfa7c_400953_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231107154421759_huf67e680e4fafdd6f4f8ee437dcadfa7c_400953_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231107154421759 class=gallery-image data-flex-grow=203 data-flex-basis=487px></p><h3 id=1366-单列索引联合索引><a href=#1366-%e5%8d%95%e5%88%97%e7%b4%a2%e5%bc%95%e8%81%94%e5%90%88%e7%b4%a2%e5%bc%95>#</a>
13.6.6 单列索引&联合索引</h3><ol><li><p>单列索引：即一个索引只包含单个列。</p></li><li><p>联合索引：即一个索引包含了多个列。</p></li></ol><p>在业务场景中，如果存在多个查询条件，考虑针对于查询字段建立索引时，建议建立联合索引，而非单列索引。</p><p><img src=/p/mysql-basic/assets/image-20231107155506044.png width=1560 height=746 srcset="/p/mysql-basic/assets/image-20231107155506044_huef05a48f40a010fdf3f4576c9b4727ed_1018789_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231107155506044_huef05a48f40a010fdf3f4576c9b4727ed_1018789_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231107155506044 class=gallery-image data-flex-grow=209 data-flex-basis=501px></p><blockquote><p>联合索引情况</p></blockquote><p><img src=/p/mysql-basic/assets/image-20231107160020078.png width=1361 height=675 srcset="/p/mysql-basic/assets/image-20231107160020078_hu7497ddc3ff055f517620f4ee74457f28_337223_480x0_resize_box_3.png 480w, /p/mysql-basic/assets/image-20231107160020078_hu7497ddc3ff055f517620f4ee74457f28_337223_1024x0_resize_box_3.png 1024w" loading=lazy alt=image-20231107160020078 class=gallery-image data-flex-grow=201 data-flex-basis=483px></p><h2 id=137-索引的设计原则><a href=#137-%e7%b4%a2%e5%bc%95%e7%9a%84%e8%ae%be%e8%ae%a1%e5%8e%9f%e5%88%99>#</a>
13.7 索引的设计原则</h2><ol><li>针对于数据量较大，且查询比较频繁的表建立索引</li><li>针对于常作为查询条件（where）、排序（order by）、分组（group by）操作的字段建立索引</li><li>尽量选择区分度高的列作为索引，尽量建立唯一索引，区分度越高，使用索引的效率越高</li><li>如果是字符串类型的字段，字段长度较长，可以针对于字段的特点，建立前缀索引</li><li>尽量使用联合索引，减少单列索引，查询时，联合索引很多时候可以覆盖索引，节省存储空间，避免回表，提高查询效率</li><li>要控制索引的数量，索引并不是多多益善，索引越多，维护索引结构的代价就越大，会影响增删改的效率</li><li>如果索引列不能存储NULL值，请在创建表时使用NOT NULL约束它。当优化器知道每列是否包含NULL值时，它可以更好地确定哪个索引最有效地用于查询</li></ol><h1 id=14-sql优化><a href=#14-sql%e4%bc%98%e5%8c%96>#</a>
14. SQL优化</h1><h2 id=141-插入数据优化><a href=#141-%e6%8f%92%e5%85%a5%e6%95%b0%e6%8d%ae%e4%bc%98%e5%8c%96>#</a>
14.1 插入数据优化</h2><h3 id=1411-普通插入><a href=#1411-%e6%99%ae%e9%80%9a%e6%8f%92%e5%85%a5>#</a>
14.1.1 普通插入</h3><ol><li>采用批量插入（一次插入的数据不建议超过500条或1000条）</li><li>手动提交事务</li><li>主键顺序插入</li></ol><h3 id=1412-大批量插入><a href=#1412-%e5%a4%a7%e6%89%b9%e9%87%8f%e6%8f%92%e5%85%a5>#</a>
14.1.2 大批量插入</h3><p>如果一次性需要插入大批量数据，使用insert语句插入性能较低，此时可以使用MySQL数据库提供的load指令插入。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>客户端连接服务端时，加上参数</span><span class=w> </span><span class=c1>--local-infile（这一行在bash/cmd界面输入）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>mysql</span><span class=w> </span><span class=c1>--local-infile -u root -p
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>#</span><span class=w> </span><span class=err>设置全局参数</span><span class=n>local_infile为1</span><span class=err>，开启从本地加载文件导入数据的开关</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>set</span><span class=w> </span><span class=k>global</span><span class=w> </span><span class=n>local_infile</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>@@</span><span class=n>local_infile</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>执行</span><span class=n>load指令将准备好的数据</span><span class=err>，加载到表结构中</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>load</span><span class=w> </span><span class=k>data</span><span class=w> </span><span class=k>local</span><span class=w> </span><span class=n>infile</span><span class=w> </span><span class=s1>&#39;/root/sql1.log&#39;</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=s1>&#39;tb_user&#39;</span><span class=w> </span><span class=n>fields</span><span class=w> </span><span class=n>terminated</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=s1>&#39;,&#39;</span><span class=w> </span><span class=n>lines</span><span class=w> </span><span class=n>terminated</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=s1>&#39;\n&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=142-主键优化><a href=#142-%e4%b8%bb%e9%94%ae%e4%bc%98%e5%8c%96>#</a>
14.2 主键优化</h2><h3 id=1421-数据组织方式><a href=#1421-%e6%95%b0%e6%8d%ae%e7%bb%84%e7%bb%87%e6%96%b9%e5%bc%8f>#</a>
14.2.1 数据组织方式</h3><p>在InnoDB存储引擎中，表数据都是根据主键顺序组织存放的，这种存储方式的表称为索引组织表（Index organized table, IOT）</p><ol><li>页分裂：页可以为空，也可以填充一般，也可以填充100%，每个页包含了2-N行数据（如果一行数据过大，会行溢出），根据主键排列。</li><li>页合并：当删除一行记录时，实际上记录并没有被物理删除，只是记录被标记（flaged）为删除并且它的空间变得允许被其他记录声明使用。当页中删除的记录到达 MERGE_THRESHOLD（默认为页的50%），InnoDB会开始寻找最靠近的页（前后）看看是否可以将这两个页合并以优化空间使用。</li></ol><p>​ MERGE_THRESHOLD：合并页的阈值，可以自己设置，在创建表或创建索引时指定</p><blockquote><p>*文字说明不够清晰明了，具体可以看视频里的PPT演示过程：*<a class=link href="https://www.bilibili.com/video/BV1Kr4y1i7ru?p=90" target=_blank rel=noopener>https://www.bilibili.com/video/BV1Kr4y1i7ru?p=90</a></p></blockquote><h3 id=1422-主键设计原则><a href=#1422-%e4%b8%bb%e9%94%ae%e8%ae%be%e8%ae%a1%e5%8e%9f%e5%88%99>#</a>
14.2.2 主键设计原则</h3><ul><li>满足业务需求的情况下，尽量降低主键的长度</li><li>插入数据时，尽量选择顺序插入，选择使用 AUTO_INCREMENT 自增主键</li><li>尽量不要使用 UUID 做主键或者是其他的自然主键，如身份证号</li><li>业务操作时，避免对主键的修改</li></ul><h2 id=143-order-by-优化><a href=#143-order-by-%e4%bc%98%e5%8c%96>#</a>
14.3 Order By 优化</h2><ol><li>Using filesort：通过表的索引或全表扫描，读取满足条件的数据行，然后在排序缓冲区 sort buffer 中完成排序操作，所有不是通过索引直接返回排序结果的排序都叫 FileSort 排序</li><li>Using index：通过有序索引顺序扫描直接返回有序数据，这种情况即为 using index，不需要额外排序，操作效率高</li></ol><p>​ 如果order by字段全部使用升序排序或者降序排序，则都会走索引，但是如果一个字段升序排序，另一个字段降序排序，则不会走索引，explain的extra信息显示的是<code>Using index, Using filesort</code>，如果要优化掉Using filesort，则需要另外再创建一个索引，如：<code>create index idx_user_age_phone_ad on tb_user(age asc, phone desc);</code>，此时使用<code>select id, age, phone from tb_user order by age asc, phone desc;</code>会全部走索引。</p><blockquote><p><strong>总结：</strong></p></blockquote><ul><li>根据排序字段建立合适的索引，多字段排序时，也遵循最左前缀法则</li><li>尽量使用覆盖索引</li><li>多字段排序，一个升序一个降序，此时需要注意联合索引在创建时的规则（ASC/DESC）</li><li>如果不可避免出现filesort，大数据量排序时，可以适当增大排序缓冲区大小 sort_buffer_size（默认256k）</li></ul><h2 id=144-group-by-优化><a href=#144-group-by-%e4%bc%98%e5%8c%96>#</a>
14.4 Group By 优化</h2><ul><li>在分组操作时，可以通过索引来提高效率</li><li>分组操作时，索引的使用也是要满足最左前缀法则的</li></ul><p>如索引为<code>idx_user_pro_age_stat</code>，则句式可以是<code>select ... where profession order by age</code>，这样也符合最左前缀法则</p><h2 id=145-limit优化><a href=#145-limit%e4%bc%98%e5%8c%96>#</a>
14.5 Limit优化</h2><p>​ 常见的问题如<code>limit 2000000, 10</code>，此时需要 MySQL 排序前2000000条记录，但仅仅返回2000000 - 2000010的记录，其他记录丢弃，查询排序的代价非常大。
​ 优化方案：一般分页查询时，通过创建覆盖索引能够比较好地提高性能，可以通过覆盖索引加子查询形式进行优化。</p><p>例如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>此语句耗时很长</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>tb_sku</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>9000000</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>通过覆盖索引加快速度，直接通过主键索引进行排序及查询</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>tb_sku</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>9000000</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>下面的语句是错误的，因为</span><span class=w> </span><span class=n>MySQL</span><span class=w> </span><span class=err>不支持</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=err>里面使用</span><span class=w> </span><span class=k>limit</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>tb_sku</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>tb_sku</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>9000000</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>通过连表查询即可实现第一句的效果，并且能达到第二句的速度</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>tb_sku</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>s</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>tb_sku</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>9000000</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=146-count优化><a href=#146-count%e4%bc%98%e5%8c%96>#</a>
14.6 Count优化</h2><blockquote><ol><li>count的几种用法</li></ol></blockquote><ul><li>如果count函数的参数（count里面写的那个字段）不是NULL（字段值不为NULL），累计值就加一，最后返回累计值</li><li>用法：count(*)、count(主键)、count(字段)、count(1)</li><li>count(主键)跟count(<em>)一样，因为主键不能为空；count(字段)只计算字段值不为NULL的行；count(1)引擎会为每行添加一个1，然后就count这个1，返回结果也跟count(</em>)一样；count(null)返回0</li></ul><blockquote><ol start=2><li>各种用法的性能</li></ol></blockquote><ul><li>count(主键)：InnoDB引擎会遍历整张表，把每行的主键id值都取出来，返回给服务层，服务层拿到主键后，直接按行进行累加（主键不可能为空）</li><li>count(字段)：没有not null约束的话，InnoDB引擎会遍历整张表把每一行的字段值都取出来，返回给服务层，服务层判断是否为null，不为null，计数累加；有not null约束的话，InnoDB引擎会遍历整张表把每一行的字段值都取出来，返回给服务层，直接按行进行累加</li><li>count(1)：InnoDB 引擎遍历整张表，但不取值。服务层对于返回的每一层，放一个数字 1 进去，直接按行进行累加</li><li>count(*)：InnoDB 引擎并不会把全部字段取出来，而是专门做了优化，不取值，服务层直接按行进行累加</li></ul><blockquote><ol start=3><li>按效率排序：</li></ol></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>count</span><span class=p>(</span><span class=err>字段</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=err>主键</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=err>，所以尽量使用</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><h2 id=147-update优化避免行锁升级为表锁><a href=#147-update%e4%bc%98%e5%8c%96%e9%81%bf%e5%85%8d%e8%a1%8c%e9%94%81%e5%8d%87%e7%ba%a7%e4%b8%ba%e8%a1%a8%e9%94%81>#</a>
14.7 Update优化（避免行锁升级为表锁）</h2><p>InnoDB 的行锁是针对索引加的锁，不是针对记录加的锁，并且该索引不能失效，否则会从行锁升级为表锁。</p><p>如以下两条语句：
<code>update student set no = '123' where id = 1;</code>，这句由于id有主键索引，所以只会锁这一行；
<code>update student set no = '123' where name = 'test';</code>，这句由于name没有索引，所以会把整张表都锁住进行数据更新，解决方法是给name字段添加索引</p></section><footer class=article-footer><section class=article-tags><a href=/tags/mysql/>MySQL</a>
<a href=/tags/sql/>SQL</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2024 半夜酒</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.25.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>